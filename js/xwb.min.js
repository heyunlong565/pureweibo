Xwb.Tpl={Box:'<div class="win-pop {.cs}"><div class="win-t"><div></div></div><div class="win-con"><div class="win-con-in">[?.title?{BoxTitlebar}?]<div class="win-box" id="xwb_dlg_ct">{.contentHtml}</div></div><div class="win-con-bg"></div></div><div class="win-b"><div></div></div>[?.closeable?<a href="#" class="icon-close-btn icon-bg" id="xwb_cls" title="关闭"></a>?]{.boxOutterHtml}</div>',DialogContent:'{.dlgContentHtml}<div class="btn-area" id="xwb_dlg_btns">{.buttonHtml}</div>',BoxTitlebar:'<h4 class="win-tit x-bg"><span id="xwb_title">{.title}</span></h4>',
Mask:'<div class="shade-div"></div>',ForwardDlgContentHtml:'<p id="xwb_forward_text"></p><div class="forward-tool"><span id="xwb_warn_tip">还可以输入140字</span><a href="#" class="icon-face-choose all-bg" id="xwb_face_trig"></a></div><textarea id="xwb_fw_input"></textarea><div id="xwb_fw_lbl"></div>',ForwardDlgLabel:'<label><input type="checkbox" value="{.uid}">同时作为{.nick}的评论发布</label>',MsgDlgContent:'<div class="tips-c"><div class="icon-alert all-bg" id="xwb_msgdlg_icon"></div><p id="xwb_msgdlg_ct"></p></div>',
Button:'<a href="#" class="general-btn {.cs}" id="xwb_btn_{.id}"><span>{.title}</span></a>',EmotionHotList:'<div class="hot-e-list" id="hotEm">{.hotList}</div>',EmotionBoxContent:'<div class="win-tab bottom-line" id="cate">\t{.category} </div><div class="emotion-box" id="box">{EmotionHotList}<div class="e-list" id="flist0">{.faces}</div></div>',ArrowBoxBottom:'<div class="arrow all-bg"></div>',EmotionIcon:'<a href="javascript:;" title="{.title}" rel="e:em"><img src="{.src}"></a>',Loading:'<div id="xweibo_loading" class="loading"></div>',
CommentArea:'<div class="feed-comment box-style hidden"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content">{.cmtBoxHtml}<ul id="cmtCt" class="hidden"></ul><div class="more-comment" id="more">后面还有<span id="lefCnt"></span>条评论，<a href="{.cmtUrl}">点击查看</a></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',CmtBox:'<div class="post-comment" id="cmtBox"><div class="post-comment-main"><a href="javascript:;" class="icon-face-choose all-bg" rel="e:ic"></a><a class="general-btn" href="javascript:;" rel="e:sd"><span>评论</span></a><div class="comment-keyin"><div><textarea class="comment-textarea" id="inputor"></textarea></div></div></div><div><span class="keyin-tips" id="warn">还可以输入140个字</span><label><input type="checkbox" id="sync"/>同时发一条微博</label></div></div>',
MBCmtBox:'<div class="feed-comment box-style" id="cmtBox"><div class="box-t skin-bg"><span class="skin-bg"></span></div><div class="box-content"><div class="post-comment"><div class="post-comment-main"><a class="icon-face-choose all-bg" href="#" rel="e:ic"></a><a href="javascript:;" class="general-btn" rel="e:sd"><span>评论</span></a><div class="comment-keyin"><div><textarea id="inputor" class="comment-textarea"></textarea></div></div></div><div><!--当超过140个字时，class="keyin-tips over-limit"--\><span class="keyin-tips" id="warn">还可以输入140个字</span><label><input type="checkbox" id="sync">同时发一条微博</label></div></div></div><div class="box-b skin-bg"><span class="skin-bg"></span></div><span class="box-arrow skin-bg"></span></div>',
Comment:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img src="{.profileImg}" title="{.nick}" alt="{.nick}的头像" width="{.picSz}" height="{.picSz}" /></a></div><div class="comment-content"><p><a href="{.usrUrl}"[?.sinaV? class="icon-v icon-bg?]>{.nick}</a>：{.text}<span>({.time})</span></p><div>[?.canDel?<a href="javascript:;" rel="e:dl">删除</a>|?]<a href="javascript:;" rel="e:rp">回复</a></div></div></li>',MBlogCmt:'<li rel="c:{.id},n:{.nick}"><div class="user-pic"><a href="{.usrUrl}"><img alt="" src="{.profileImg}" /></a></div><div class="comment-c"><p class="c-info"><a href="{.usrUrl}"[?.sinaV? class="icon-v icon-bg?]>{.nick}</a>{.text}({.time}) </p><div class="c-for" id="trigs"><a href="javascript:;" class="icon-reply icon-bg" rel="e:rp">回复</a></div>{.cmtBoxHtml}[?.canDel?<a href="javascript:;" class="icon-del icon-bg" rel="e:dl">删除</a>?]</div></li>',
Followed:'<span class="followed-icon {.cs}">已关注</span>',MediaBoxContentHtml:'<div class="insert-box"><p>请输入<a href="http://video.sina.com.cn" target="_blank">新浪播客</a>、<a href="http://www.youku.com" target="_blank">优酷网</a>、<a href="http://www.tudou.com" target="_blank">土豆网</a>、<a href="http://www.ku6.com/" target="_blank">酷6网</a>等视频网站的视频播放页链接</p><input type="text" id="xwb_inputor"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',
PictureBox:'<div class="box-style" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="box-content">   <div class="show-img"><p><a href="#" rel="e:zo" class="icon-piup icon-bg">收起</a>   <a href="{.org}" target="_blank" class="icon-src icon-bg">查看原图</a>   <a href="#" class="icon-trunleft icon-bg" rel="e:tl">向左转</a>   <a href="#" class="icon-trunright icon-bg" rel="e:tr">向右转</a></p>   <div name="img"></div></div>   </div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',
PictureBoxForward:'<div class="show-img cutline" style="display:none"><p><a class="icon-piup icon-bg" rel="e:zo" href="#">收起</a><a class="icon-src icon-bg" target="_blank" href="{.org}">查看原图</a><a rel="e:tl" class="icon-trunleft icon-bg" href="#">向左转</a><a rel="e:tr" class="icon-trunright icon-bg" href="#">向右转</a></p><div name="img"></div></div>',PreviewBox:'<div class="preview-img"></div>',VideoThumbHtml:'<div class="feed-img"><img width="120px" src="{.img}" alt=""><div class="video-view all-bg" rel="e:pv,i:{.id}"></div></div>',
VideoBox:'<div class="box-style showbox" style="display:none">\t<div class="box-t skin-bg"><span class="skin-bg"></span></div>\t<div class="show-video box-content">   <p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p>   <div>{.flash}</div></div>\t<div class="box-b skin-bg"><span class="skin-bg"></span></div>\t<span class="box-arrow skin-bg"></span></div>',VideoBoxForward:'<div class="cutline show-video"><p><a rel="e:cv" href="#" class="icon-piup icon-bg">收起</a><span>|</span><a title="{.title}" target="_blank" href="{.href}">{.title}</a></p><div>{.flash}</div></div>',
MusicBoxContentHtml:'<div class="insert-box music-box"><p>请输入<a href="http://music.sina.com.cn/yueku/" target="_blank">新浪乐库</a>等音乐站点的音乐播放页链接</p><input type="text" id="xwb_inputor"><a href="#" class="general-btn" rel="e:ok"><span>确定</span></a><p class="error-tips hidden" id="xwb_err_tip">你输入的链接地址无法识别<span><a href="#" rel="e:cc">取消操作</a>或者<a href="#" rel="e:nm">作为普通的链接</a>发布。</span></p></div>',UploadImgBtn:'<a href="#" rel="e:dlp" class="icon-close-btn icon-bg" title="删除"></a>',SearchDropdownList:'<ul class="head-searchlist"><li class="mouseover">含<span></span>的微博</li><li>名<span></span>的人</li></ul>',
PrivateMsgContent:'<div class="field"><label>发私信给:</label><input type="text" id="sender" /><em class="warn warn-pos hidden" id="warnPos">她还没有关注你,暂时不能发私信</em></div><div class="field"><label>私信内容:</label><textarea id="content"></textarea></div><input type="hidden" id="uid" value=""><div class="field pad"><div class="icon-face-choose all-bg fl" rel="e:ic"></div><div class="fr"><span class="tips fl" id="word">您还可以输入300个字</span><a class="general-btn highlight fl" href="javascript:;" rel="e:sd"><span>发送</span></a></div></div>',
NoticeLayer:'<div class="new-tips-fixed hidden"><h4 id="xwb_title">提示</h4><p id="wbs" class="hidden"><span id="c">0</span>条新微博，<a href="{.wbsUrl}">点击查看</a></p><p id="fans" class="hidden"><span id="c">0</span>个新粉丝，<a href="{.fansUrl}">点击查看</a></p><p id="cmts" class="hidden"><span id="c">0</span>条新评论，<a href="{.cmtsUrl}">点击查看</a></p><p id="msgs" class="hidden"><span id="c">0</span>封新私信，<a href="{.msgsUrl}">点击查看</a></p><p id="refer" class="hidden"><span id="c">0</span>条微博提到了你，<a href="{.referUrl}">点击查看</a></p><a href="#" class="icon-close-btn icon-bg" id="xwb_cls" ></a></div>',
NoticeLayer2:'<div class="new-tips"><a id="wbs" class="hidden" href="{.wbsUrl}"><span id="c">0</span>条新微博</a><a id="fans" class="hidden" href="{.fansUrl}"><span id="c">0</span>个新粉丝</a><a id="cmts" class="hidden" href="{.cmtsUrl}"><span id="c">0</span>条新评论</a><a id="msgs" class="hidden" href="{.msgsUrl}"><span id="c">0</span>封新私信</a><a id="refer" class="hidden" href="{.referUrl}"><span id="c">0</span>条微博提到了你</a><a href="javascript:;" class="icon-close-btn icon-bg" id="xwb_cls"></a></div>',Login:'<div class="login-area">\t<span><a href="{.regUrl}">注册帐号</a></span><a class="btn-web-account bind-btn-bg" href="{.siteLoginUrl}">{.siteName}登录</a>\t<span><a href="http://t.sina.com.cn/reg.php" target="_blank">开通微博</a></span><a class="btn-sina-account bind-btn-bg" href="#" id="oauth">新浪微博帐号登录</a></div><div class="bind-tips">提示：您可以使用{.siteName}帐号或新浪微博帐号登录本网站</div>',
PostBoxContent:'<div class="post-box"><div class="key-tips" id="xwb_word_cal">您还可以输入<span>140</span>字</div><div class="post-textarea skin-bg"><textarea id="xwb_inputor"></textarea></div><div class="add-area"><a class="icon-face icon-bg" href="#" rel="e:ic">表情</a><span class="pic_uploading hidden" id="xwb_upload_tip">正在上传..</span><span class="hidden" id="xwb_photo_name"><a class="icon-close-btn icon-bg" href="#" ></a></span><a class="icon-pic icon-bg" href="#" id="xwb_btn_img">图片</a><a class="icon-video icon-bg" href="#" id="xwb_btn_vd" rel="e:vd">视频</a><a class="icon-music icon-bg" href="#" id="xwb_btn_ms" rel="e:ms">音乐</a><a class="icon-topic icon-bg" href="#" id="xwb_btn_tp" rel="e:tp">话题</a></div><div class="share-btn skin-bg" rel="e:sd"></div><form class="upload-pic"  method="post"  enctype="multipart/form-data" id="xwb_post_form" action="" target="" id="xwb_imgupload_form"><input type="file" name="pic" id="xwb_img_file" value="" /></form><div class="post-tips">请输入要发布的微博内容</div><div class="post-success all-bg hidden" id="xwb_succ_mask"></div></div>',
AnchorTipContent:'<div class="tips-c"><div class="icon-correct icon-bg"></div><p id="xwb_title"></p></div>',AnchorDlgContent:'<div class="tips-c"><div class="icon-warn icon-bg"></div><p id="xwb_title"></p></div>'};(function(k,g){function q(a,b,d){var i,o=[],z=[];d||(d="\\");for(var C=0,H=a.length;C<H;C++){i=a.charAt(C);if(i===b){o.push(z.join(""));z.length=0}else{if(i===d&&a.charAt(C+1)===b){i=b;C++}z[z.length]=i}}z.length&&o.push(z.join(""));return o}function A(a){var b={},d,i=q(a,",");try{for(var o=0,z=i.length;o<z;o++)if(i[o].indexOf(":")===-1)b[i[o]]=l;else{d=q(i[o],":");b[d[0]]=d[1]}}catch(C){__debug&&console.trace();throw"Syntax Error:rel字符串格式出错。"+a;}return b}function y(a){this.q=a;this.idx=-1;this.end=
this.q.length-1}function w(a){this.mgr=a;this.nextChain=x.bind(this.doNextChain,this)}function m(){return this.view}var l=true,n=document,r=10001,s=k.Tpl,D=k.request,x=k.util=D.util;window.__debug=false;if(window.__debug){if(!window.console)window.console={};(function(a,b){a||(a={});if(b)for(var d in b)if(a[d]===void 0)a[d]=b[d];return a})(console,{debug:g.noop,trace:g.noop,log:g.noop,warn:g.noop,error:g.noop,group:g.noop,groupEnd:g.noop})}var G=/\[\?\.([\w_$]+?)\?([\S\s]*?)\?\]/g,N=/\{(\.?[\w_$]+)\}/g;
s.parse=function(a,b){b||(b={});if(a.charAt(0)!=="<"){var d=s[a];if(d)a=d}a=a.replace(G,function(i,o,z){return b[o]===void 0?"":z});return a.replace(N,function(i,o){var z=o.charAt(0)==="."?b[o.substr(1)]:s[o];if(z===void 0||z===null)return"";if(z.toString().charAt(0)==="<")return s.parse(z,b);if(s[z])return s.parse(s[z],b);return z})};s.forNode=function(a,b){if(b)a=this.parse(a,b);return g(a).get(0)};s.get=function(a){return this[a]};var c=0,e=document.selection;g.extend(x,{arrayRemove:function(a,
b){a.splice(b,1)},arrayIndexOf:function(a,b){for(var d=0,i=a.length;d<i;d++)if(a[d]===b)return d;return-1},create:function(){var a=function(){this.init.apply(this,arguments)};if(arguments.length===0)return a;var b,d,i,o=g.makeArray(arguments);if(typeof o[0]==="string"){i=o[0];d=o[1];o.shift()}else d=o[0];o.shift();if(d)d=d.prototype;if(d){b=function(){};b.prototype=d;a.prototype=b=new b}if(i){b.type=i;x.ns(i,a)}i=0;for(var z=o.length;i<z;i++)g.extend(b,typeof o[i]==="function"?o[i](d):o[i]);return b.constructor=
a},domUp:function(a,b,d){d=d||n.body;for(var i=typeof b==="string";a;){if(i){if(g(a).is(b))break}else if(b(a))break;a=a.parentNode;if(a===d)return null}return a},ns:function(a,b){for(var d=a.split("."),i=window,o,z=0,C=d.length-1;z<C;z++){o=d[z];i[o]||(i[o]={});i=i[o]}i[d[z]]=b},calWbText:function(a,b){if(b===void 0)b=140;var d=a.match(/[^\x00-\xff]/g);return Math.floor((b*2-a.length-(d&&d.length||0))/2)},byteLen:function(a){var b=a.length;if(a=a.match(/[^\x00-\xff]/g))b+=a.length;return b},byteCut:function(a,
b){if(x.byteLen(a)>b){var d=a.replace(/&/g," ").replace(/[^\x00-\xff]/g,"&&");a=a.slice(0,d.slice(0,b).replace(/&&/g," ").replace(/&/g,"").length)}return a},stringReplace:function(a,b,d,i){return a.substring(0,d)+b+a.substring(i)},focusEnd:function(a,b){a.focus();if(b===void 0)b=a.value.length;if(document.selection){var d=a.createTextRange();d.collapse();d.moveStart("character",b);d.moveEnd("character",b);d.select()}else a.selectionStart=a.selectionEnd=b},selectionStart:function(a){if(!e)return a.selectionStart;
var b=e.createRange(),d,i=document.body.createTextRange();i.moveToElementText(a);try{for(d=0;i.compareEndPoints("StartToStart",b)<0;d++)i.moveStart("character",1)}catch(o){d=this.getCursorPos(a)}return d},selectionBefore:function(a){return a.value.slice(0,this.selectionStart(a))},selectText:function(a,b,d){a.focus();if(e){a=a.createTextRange();a.collapse(1);a.moveStart("character",b);a.moveEnd("character",d-b);a.select()}else a.setSelectionRange(b,d)},insertText:function(a,b,d){a.focus();len=len||
0;if(d===void 0)d=this.selectionStart(a);if(e){a=e.createRange();a.moveStart("character",-len);a.text=b}else{d-=len;b=d+b.length;a.value=this.selectText(a,b,b)}},hasSelectionSupport:function(){var a=false;if("selectionStart"in document.createElement("TEXTAREA"))a=l;this.hasSelectionSupport=function(){return a};return a},getCursorPos:function(a){var b=0;if(this.hasSelectionSupport()){if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart}else{a.focus();b=null;b=e.createRange();var d=b.duplicate();
d.moveToElementText(a);d.setEndPoint("EndToEnd",b);a.selectionStart=d.text.length-b.text.length;a.selectionEnd=a.selectionStart+b.text.length;b=a.selectionStart}return b},getSelectionText:function(a){var b="";return b=window.getSelection?a.selectionStart!=void 0&&a.selectionEnd!=void 0?a.value.substring(a.selectionStart,a.selectionEnd):"":e.createRange().text},setCursor:function(a,b,d){b=b==null?a.value.length:b;d=d==null?0:d;a.focus();if(a.createTextRange){a=a.createTextRange();a.move("character",
b);a.moveEnd("character",d);a.select()}else a.setSelectionRange(b,b+d)},replaceSelection:function(a,b){a.focus();var d=this.selectionStart(a),i=this.getSelectionText(a).length,o=a.value;i=i===0?d:d+i;a.value=x.stringReplace(o,b,d,i);this.setCursor(a,d+b.length);return d},delSelection:function(){end+=start},escapeHtml:function(a){return a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):""},disable:function(a,b,d){b?g(a).addClass(d||"general-btn-disabled"):g(a).removeClass(d||"general-btn-disabled")},getBind:function(a,
b){var d="__"+b,i=a[d];i||(i=a[d]=x.bind(a[b],a));return i},uniqueId:function(){return++c},appendParam:function(a,b){var d=this.queryString(b);return a+(a.indexOf("?")!==-1?"&"+d:"?"+d)},getFileName:function(a,b){if(a.indexOf("\\"))a=a.split("\\").pop();if(a.length>b)a=a.substr(0,b-4)+".."+a.substr(a.length-4);return a}});var h=k.Cache={MAX_ITEM_SIZE:3,reg:function(a,b,d){if(this[a])this[a][1]=b;else this[a]=[null,b];d!==void 0&&this.sizeFor(a,d)},get:function(a){a=this[a];if(a===void 0)return null;
var b=a[1];a=a[0];if(a===null)return b();if(a.length>1)return a.pop();if(b)return b();return null},put:function(a,b){var d=this[a];if(d){var i=d[0];i||(d[0]=i=[this.MAX_ITEM_SIZE]);i.length-1>=i[0]||i.push(b)}else this[a]=[[this.MAX_ITEM_SIZE,b]]},remove:function(a){this[a]&&delete this[a]},sizeFor:function(a,b){var d=this[a];d||(this[a]=d=[[]]);d[0]||(d[0]=[]);d[0][0]=b}};h.reg("div",function(){return n.createElement("DIV")});k.getCfg=function(a){return k.cfg&&k.cfg[a]};k.getSiteUid=function(){return parseInt(k.getCfg("siteUid"))};
k.getUid=function(){var a=k.getCfg("uid");return a!=="0"&&a};k.getWb=function(a){var b=k.getCfg("wbList");if(a)return b&&b[a];return b};k.setWb=function(a,b){k.cfg.wbList&&(k.cfg.wbList[a]=b)};g.extend(k,{_cls:{},reg:function(a,b,d){if(this._cls[a]!==void 0&&!d){__debug&&console.trace();throw"已定义类"+a;}return this._cls[a]=b},use:function(a,b){var d=this._cls[a];if(d){if(typeof d==="object")return d;if(typeof b==="function")return new d(b(d.prototype));return new d(b)}return null},isModule:function(a){return this.getModule()===
a},getModule:function(){if(this._mod===void 0){var a=location.href,b=a.indexOf("?");if(b!==-1)if(a=a.substring(b+1)){a=a.split("&");b=0;for(var d=a.length;b<d;b++){var i=a[b].split("=");if(i.length===2&&i[0]==="m"){this._mod=i[1];break}}}if(this._mod===void 0)this._mod=false;else{a=this._mod.indexOf("#");if(a!=-1)this._mod=this._mod.substring(0,a)}}return this._mod}});k.ax={};y.prototype={prevented:void 0,stopPropagationed:void 0,get:function(a){var b=this.getRel(a);return b&&b.data&&b.data[a]},escape:function(a){a=
this.get(a);if(a!==void 0)return escape(a)},getEl:function(a){return(a=this.getRel(a))&&a.src},jq:function(a,b){var d=g(this.getEl(a));if(b)d=d.find(b);return d},getRel:function(a){for(var b=this.q,d=this.idx,i=this.end;d<=i;d++)if(b[d].data[a]!==void 0)return b[d]},_next:function(){var a=this.q[++this.idx];if(a===void 0)this.idx=0;return a},clone:function(){var a=new y(this.q);a.idx=0;return a},preventDefault:function(a){this.prevented=a},stopPropagation:function(a){this.stopPropagationed=a},lock:function(a,
b){var d="xwb_e_"+this.data.e;if(b)d+="_"+b;if(a===void 0)return g(this.src).data(d);g(this.src).data(d,a)}};k.ax.ActionMgr=k.reg("ActionMgr",function(){this.actions={};this.filters=[];if(this.target){this.bind(this.target);delete this.target}});var j=[];k.ax.ActionMgr.prototype={trigEvent:"click",cacheNodeData:l,reg:function(a,b,d){b={n:a,h:b};d&&g.extend(b,d);this.actions[a]=b;return this},get:function(a){return this.actions[a]},addFilter:function(a,b){b?j.push(a):this.filters.push(a);return this},
bind:function(a,b){var d=this;g(a).bind(b||this.trigEvent,function(i){var o=d.collectRels(i.target,this);o&&d.fireRels(o,i)});return this},doAct:function(a,b){var d=this.collectRels(a,b);return!(d&&this.fireRels(d))},collectRels:function(a,b){var d,i=this.cacheNodeData,o,z=this;x.domUp(a,function(C){var H=g(C);if(i){o=H.data("xwb_rel");if(!o)if(o=H.attr("rel")){o={src:C,data:z.parseRel(o)};H.data("xwb_rel",o)}}else if(o=H.attr("rel"))o={src:C,data:z.parseRel(o)};if(o){d||(d=[]);d[d.length]=o}},b);
return d},parseRel:function(a){return A(a)},wrapRel:function(a,b){var d=this.collectRels(a,b);d=new y(d);d._next();return d},getRel:function(a,b,d){return this.wrapRel(a,d).get(b)},fireRels:function(a,b){var d=new y(a);d.evt=b;__debug&&console.log("act e:",d);for(var i,o,z=j.length,C=this.filters.length,H,I,K;i=d._next();){o=i.data;if(o.e){d.src=i.src;d.data=o;if(d.lock()){__debug&&console.warn("action e:"+d.data.e+" has been locked for resubmiting");I=K=H=l;break}else{i=this.actions[o.e];if(z){H=
l;if(this._fireArray(j,d,i)===false){K=d.stopPropagationed;I=d.prevented;break}}if(C){H=l;if(this._fireArray(this.filters,d,i)===false)break}K=d.stopPropagationed;I=d.prevented;if(i){var J=d.clone();J.src=d.src;J.data=o;J.evt=b;__debug&&console.log("act e:",J);H||(H=l);if(i.h.call(this,J)===false){if(J.stopPropagationed!==void 0)K=J.stopPropagationed;if(J.prevented!==void 0)I=J.prevented;break}if(J.stopPropagationed!==void 0)K=J.stopPropagationed;if(J.prevented!==void 0)I=J.prevented}}}}if(b&&H){if(I===
void 0)I=l;if(K===void 0)K=l;I&&b.preventDefault();K&&b.stopPropagation()}},_fireArray:function(a,b,d){for(var i=0,o=a.length;i<o;i++)if(a[i].call(this,b,d)===false)return false}};k.reg("action",k.use("ActionMgr"));var p;k.ax.Validator=k.reg("Validator",function(a){g.extend(this,a);this.init()});var t={};w.prototype={doChain:function(a,b,d){var i=a.value;if(typeof i==="string")i=g.trim(i);this.elVal=i;this.tmpData={};this.elem=a;this.validators=b;this.finalChain=d;this.idx=-1;this.error=0;this.doNextChain()},
doNextChain:function(){this.idx++;if(this.idx===this.validators.length){if(!this.error){__debug&&console.log("onpass",this.elem);this.mgr.onpass(this.elem,this.elVal)}this.finalChain&&this.finalChain()}else{var a=this.validators[this.idx];if(a.isPreCmd)this.nextChain();else typeof a==="function"?a.call(this.mgr,this.elem,this.elVal,t,this.nextChain):a[0].call(this.mgr,this.elem,this.elVal,a[1],this.nextChain)}}};k.ax.Validator.prototype={useCache:l,autoFocus:l,tipName:"warntip",tipTextNode:"#tle",
decorateTrigger:l,warnType:1,onerror:function(a,b){var d=g(a).attr(this.tipName);if(d&&b.m){var i=this.elValiChain.tmpData.errors;if(!i)i=this.elValiChain.tmpData.errors=[];i.push(b.m);d=g(d);var o=d.cssDisplay(l).find(this.tipTextNode);o.length||(o=d);if(this.warnType===1)i.length==1&&o.text(i[0]);else o.text(i.join("，"))}},onpass:function(a){(a=g(a).attr(this.tipName))&&g(a).cssDisplay(false)},onfinal:g.noop,trigOnSubmit:l,reg:function(a,b){p||(p={});if(g.isArray(a))for(var d=0,i=a.length;d<i;d++)this.reg.apply(this,
a[d]);else p[a]=b;return this},add:function(a,b){var d=this.extraValidators;if(!d)d=this.extraValidators={};var i=d[a];if(i)i.push(b);else d[a]=[b]},init:function(){p||(p={});this.nextChain=x.bind(this.doNextChain,this);this.elValiChain=new w(this);this.form=g(this.form).get(0);var a=this;g.each(this.form.elements,function(){for(var d=a.getEleValidators(this,false,this.useCache),i=0,o=d.length;i<o;i++)d[i].isPreCmd&&d[i][0].call(a,this,d[i][1])});a=this;var b=function(){a.validate();return false};
if(this.trigOnSubmit)this.form.onsubmit=b;if(this.trigger){this.trigger=g(this.trigger)[0];g(this.trigger).click(function(){return b()})}},validElement:function(a,b,d){if(!this.isGlobalVal){this.error=0;this.validElement0(a,b,d)}},validElement0:function(a,b,d){b=this.getEleValidators(a,b);if(b.length)this.elValiChain.doChain(a,b,d);else d&&d()},validate:function(){if(!this.isGlobalVal){this.elems=this.form.elements;this.currElIdx=-1;this.error=0;this.isGlobalVal=l;this.data={};this.param&&g.extend(this.data,
this.param);this.decorateTrigger&&this.trigger&&x.disable(this.trigger,l);this.doNextChain()}return false},finalChain:function(){this.onfinal();this.isGlobalVal=false;this.data&&delete this.data;this.decorateTrigger&&this.trigger&&x.disable(this.trigger,false)},parseCmd:function(a){var b=[];a=q(a,"|");for(var d,i=0,o=a.length;i<o;i++){if(a[i].indexOf("=")===-1)d=[a[i],{}];else{d=q(a[i],"=");d[1]=A(d[1])}if(d[0].charAt(0)==="_"){d.isPreCmd=l;d[0]=d[0].substr(1)}b[b.length]=d}return b},getEleValidators:function(a,
b){var d;d=false;if(!b){b=g(a).attr("vrel");d=this.useCache}if(b){var i=g(a);if(d)if(i.data("xwb_vd_cmds"))d=i.data("xwb_vd_cmds");else{d=this.parseCmd(b);i.data("xwb_vd_cmds",d)}else d=this.parseCmd(b);i=p;for(var o=this.validators,z,C=0,H=d.length;C<H;C++){var I=d[C][0];if(typeof I==="string"){z=o&&o[I]||i[I];if(!z){__debug&&console.trace();throw"Undefine cmd :"+I+",in element "+a.name;}d[C][0]=z}}}else d=[];(i=this.extraValidators)&&i[a.name]&&g.merge(d,i[a.name]);return d},report:function(a,b){if(!a){this.error++;
this.elValiChain.error++;__debug&&console.log("onerror",this.elValiChain.elem,b);this.onerror(this.elValiChain.elem,b);this.error===1&&this.isGlobalVal&&this.autoFocus&&this.elValiChain.elem.focus()}},setValue:function(a){this.elValiChain.elVal=a},onsuccess:function(a,b){__debug&&console.log(a);b()},doNextChain:function(){var a=this.elems.length;this.currElIdx>=0&&this.currElIdx<a&&!this.error&&this.collectValue(this.elems[this.currElIdx]);this.currElIdx++;if(this.currElIdx===a)if(this.error)this.finalChain();
else this.onsuccess(this.data,this.nextChain)!==false&&this.form.submit();else if(this.currElIdx>a)this.finalChain();else{a=this.elems[this.currElIdx];if(a.disabled)this.doNextChain();else if(a.tagName==="INPUT"&&(a.type==="radio"||a.type==="checkbox"))a.checked?this.validElement0(a,false,this.nextChain):this.doNextChain();else this.validElement0(a,false,this.nextChain)}},collectValue:function(a){if(a.tagName==="INPUT"&&(a.type==="radio"||a.type==="checkbox")){if(a.checked)this.data[a.name]=a.value}else this.data[a.name]=
a.value}};k.ax.Uploader=k.reg("Uploader",function(a){this.init(a)});k.ax.Uploader.prototype={init:function(a){g.extend(this,a);a=this.form;var b="xwb_upload_frame_"+x.uniqueId();this.iframe=s.forNode('<iframe src="about:blank" style="display:none;" id="'+b+'" name="'+b+'"></iframe>');g('<input type="hidden" name="callback"/>').appendTo(a);g(this.iframe).appendTo(n.body);a.target=b;if(!this.action)this.action=a.action||D.apiUrl("action","upload_pic")},setAction:function(a){this.action=a;return this},
isLoading:function(){return!!this.jsonpFn},upload:function(a){this.isLoading()&&this.abort();var b=this,d=this.jsonpFn="jsonp"+(new Date).getTime();window[d]=function(){window[d]=null;delete b.jsonpFn;(a||b.onload).apply(b,arguments);delete b.jsonpFn};this.form.action=x.appendParam(this.action,{callback:"parent."+d,_:x.uniqueId()});this.form.submit()},onload:g.noop,abort:function(){if(this.isLoading()){var a=this.jsonpFn;window[a]=function(){window[a]=null}}}};k.ax.SelectionHolder=function(a){g.extend(this,
a);x.hasSelectionSupport()||this.initEvent(this.elem)};k.ax.SelectionHolder.prototype={pos:-1,length:0,initEvent:function(){var a=this,b=function(){try{a.saveSpot()}catch(d){}};g(this.elem).mouseup(b).keyup(b).data("xwb_selholder",this)},saveSpot:function(){var a=this.elem;this.pos=x.getCursorPos(a);this.length=x.getSelectionText(a).length},insertText:function(a){var b=this.elem,d=b.value;if(x.hasSelectionSupport())x.replaceSelection(b,a);else if(this.pos===-1){b.value=d+a;x.focusEnd(b)}else{b.value=
x.stringReplace(d,a,this.pos,this.pos+this.length);x.setCursor(b,this.pos+a.length)}this.saveSpot()},setText:function(a){this.elem.value=a;try{this.focusEnd()}catch(b){}},clearSpot:function(){this.length=0;this.pos=-1},focusEnd:function(){x.focusEnd(this.elem);this.saveSpot()},focusStart:function(){x.setCursor(this.elem,0);this.saveSpot()}};k.reg("SelectionHolder",k.ax.SelectionHolder);var u=k.reg("contextMgr",{context:function(a){a.contexted&&this.release(a);var b=this.q;if(!b)this.q=b=[];b.length||
g(n).mousedown(this._getDocEvtHandler());b[b.length]=a;this._setCompEvtHandler(a,l);a.contexted=l;__debug&&console.log("contexted",a)},release:function(a,b){a.contexted=false;if(a.onContextRelease(b)!==false){this._setCompEvtHandler(a,false);x.arrayRemove(this.q,a);this.q.length||g(n).unbind("mousedown",this._getDocEvtHandler())}else a.contexted=l;__debug&&console.log("release context",a)},releaseAll:function(a){var b=this.q;if(b){if(a)var d=a.target;for(var i=b.length-1;i>=0;i--)if(!d||!b[i].ancestorOf(d))this.release(b[i],
a)}},_setCompEvtHandler:function(a,b){b?a.domEvent("mousedown",this._compEvtStopHandler):a.unDomEvent("mousedown",this._compEvtHandler)},_getDocEvtHandler:function(){var a=this.docEvtHd;if(!a)a=this.docEvtHd=x.bind(this._docHandler,this);return a},_releaseFollower:function(a,b){var d=this.q;if(d){var i=d.length-1;if(i!==-1&&d[i]!==a)for(;i>=0;i--){if(d[i]===a)break;this.release(d[i],b)}}},_compEvtStopHandler:function(a){u._releaseFollower(this,a);return false},_compEvtHandler:function(a){u._releaseFollower(this,
a)},_docHandler:function(a){this.releaseAll(a)}}),v=k.ui={Base:x.create()},B=v.Base;v.Base.prototype={autoRender:false,titleNode:"#xwb_title",init:function(a){this.cacheId="c"+x.uniqueId();a&&g.extend(this,a);this.initUI();this.autoRender&&this.getView()},initUI:g.noop,clsNode:"#xwb_cls",initClsBehave:function(a){this.jq(this.clsNode).click(x.bind(this.onClsBtnClick,this));this.setCloseable(a)},setCloseable:function(a){this.fly(this.clsNode).display(a);this.closeable=a},onClsBtnClick:function(){this.close(l);
return false},close:function(){if(!this.onclose||this.onclose()!==false)this.destroyOnClose?this.destroy():this.display(false)},createView:function(){var a=this.view;if(typeof a==="string")a=this.view=s.forNode(s[a],this,l);else this.view=a=n.createElement("DIV");return a},innerViewReady:g.noop,setTitle:function(a){this.jq(this.titleNode).html(a);return this},getView:function(){var a=this.view;if(!a||!a.tagName)a=this.createView();this.getView=m;if(this.hidden!==void 0){var b=this.hidden;this.hidden=
void 0;this.display(!b)}if(this.appendTo){g(this.appendTo).append(a);delete this.appendTo}this.closeable!==void 0&&this.initClsBehave(this.closeable);if(this.actionMgr===l){this.actionMgr=k.use("ActionMgr");this.actionMgr.bind(a);if(this.onactiontrig){var d=this;this.actionMgr.addFilter(function(i){return d.onactiontrig(i)})}}this.innerViewReady(a);this.onViewReady&&this.onViewReady(a);return a},beforeShow:g.noop,afterShow:g.noop,beforeHide:g.noop,jqExtra:function(){for(var a=arguments,b=0,d=a.length;b<
d;b++){var i=a[b],o=this.jq("#"+i);if(o){i=i.charAt(0).toUpperCase()+i.substring(1);this["jq"+i]=o}}return this},display:function(a){var b=this.jq();if(a===void 0)return!b.hasClass("hidden");a=!a;if(this._flied||this.hidden!==a)if(a){if(this.beforeHide()!==false){this.hidden=a;b.addClass("hidden");this.afterHide&&this.afterHide();this.contexted&&this.setContexted(false)}}else{this.hidden=a;b.css("visibility","hidden").removeClass("hidden");this.beforeShow();b.css("visibility","");this.contextable&&
!this.contexted&&this.setContexted(l);this.afterShow()}return this},onContextRelease:function(){this.display(false)},appendAt:function(a){g(a).append(this.getView());return this},ancestorOf:function(a,b){a=a.view||a;var d=this.view;if(d.contains&&!g.browser.webkit)return d.contains(a);else if(d.compareDocumentPosition)return!!(d.compareDocumentPosition(a)&16);if(b===void 0)b=65535;for(var i=a.parentNode,o=n.body;i!=o&&b>0&&i!==null;){if(i==d)return l;i=i.parentNode;b--}return false},jq:function(a){return a===
void 0?g(this.getView()):g(this.getView()).find(a)},fly:function(a){if(typeof a==="string")a=this.jq(a);return B.fly(a)},unfly:function(){delete this.view},destroy:function(){this.display(false);this.jq().remove()},domEvent:function(a,b,d){if(a==="mousedown"){var i=this,o=function(z){i.contexted||u.releaseAll(z);b.apply(i,arguments)};if(!this._mousedownFns)this._mousedownFns={};this._mousedownFns[b]=o;this.jq(d).bind(a,o)}else this.jq(d).bind(a,b)},unDomEvent:function(a,b,d){if(a==="mousedown"){var i=
this._mousedownFns[b];this.jq(d).unbind(a,i);delete this._mousedownFns[b]}else this.jq(d).unbind(a,b)},setContexted:function(a){if(this.contexted!==a)a?u.context(this):u.release(this);return this},templ:function(a){for(var b in a)this.jq(b).html(a[b]);return this},offset:function(){if(arguments.length){this.jq().css(arguments[0]);return this}return this.jq().offset()},anchor:function(a,b,d){var i=g(a);a=this.jq();var o=i.offset(),z=i.width();i.height();i=a.width();var C=a.height(),H=b.charAt(0),I=
b.charAt(1);b=o.left;o=o.top;switch(H){case "t":o-=C}switch(I){case "c":b+=Math.floor((z-i)/2)}if(d){z=z=[b,o];d(z,i,C);b=z[0];o=z[1]}a.css("left",b+"px").css("top",o+"px")},center:function(){var a=this.jq(),b=[L.width(),L.height()];a=[a.width(),a.height()];var d=(b[1]-a[1])*0.8;this.view.style.left=Math.max((b[0]-a[0])/2|0,0)+g(n).scrollLeft()+"px";this.view.style.top=Math.max(d-d/2|0,0)+g(n).scrollTop()+"px";return this},clip:function(){if(!B.CLIP_WRAPPER_CSS){B.CLIP_WRAPPER_CSS={position:"absolute",
clear:"both",overflow:"hidden"};B.CLIPPER_CSS={position:"absolute",left:0,top:0}}if(!this.jqClipWrapper){var a=g(h.get("div")),b=this.getView(),d=this.jq(),i=b.parentNode,o=d.offset();a.css(B.CLIP_WRAPPER_CSS).css(o).css("width",d.width()+"px").css("height",d.height()+"px").css("z-index",d.css("z-index")).append(b);o=this._tmpClipedCss={};for(var z in B.CLIPPER_CSS)o[z]=b.style[z];d.css(B.CLIPPER_CSS);i&&a.appendTo(i);this.jqClipWrapper=a}return this.jqClipWrapper},unclip:function(){if(this.jqClipWrapper){var a=
this.jqClipWrapper[0],b=a.style,d=this.jq(),i=d[0].style,o;for(o in B.CLIP_WRAPPER_CSS)b[o]="";this.jqClipWrapper.css("overflow","").css("width","").css("height","");b=this._tmpClipedCss;for(o in b)i[o]=b[o];delete this._tmpClipedCss;a.removeChild(d[0]);a.parentNode&&this.jqClipWrapper.replaceWith(d);h.put("div",a);delete this.jqClipWrapper}},slide:function(a,b,d,i,o,z){var C=this.jq(),H=C.width(),I=C.height(),K=0,J=0,O=0,P=0;this.clip();var R=a.charAt(0);a=a.charAt(1);switch(R){case "l":K=0-H;break;
case "r":K=0+H;break;case "t":J=0-I;break;case "b":J=0+I}switch(a){case "l":O=0-H;break;case "r":O=0+H;break;case "t":P=0-I;break;case "b":P=0+I}C.css("left",K).css("top",J);i||(i={});if(O!=K)i.left=i.left===void 0?O:i.left+O;if(P!=J)i.top=i.top===void 0?P:i.top+P;b&&C.css("visibility","");var Q=this;C.animate(i,o||"fast",z,function(){if(!b){Q.display(false);C.css("visibility","")}setTimeout(function(){Q.unclip();d&&d(Q)},0)})}};var E=new v.Base;E._flied=l;E.unfly=function(){this.view=null};B.fly=
function(a){if(a)if(typeof a==="string")a=g(a)[0];else if(a.get)a=a[0];E.view=a;return E};k.reg("base",B);var F={layers:[],hash:{},keyListeners:0,add:function(a){var b=a.cacheId;if(!this.hash[b]){this.layers.push(a);if(a.keyEvent){if(this.keyListeners===0){__debug&&console.log("bind key listener");g(n).bind("keydown",this.getEvtHandler())}this.keyListeners++}this.hash[b]=l}},remove:function(a){var b=a.cacheId;if(this.hash[b]){var d=this.layers;d[d.length-1]===a?d.pop():x.arrayRemove(d,a);this.keyListeners--;
if(this.keyListeners===0){__debug&&console.log("remove key listener");g(n).unbind("keydown",this.getEvtHandler())}delete this.hash[b]}},getEvtHandler:function(){var a=this._onDocKeydown;if(!a)a=this._onDocKeydown=x.bind(this.onDocKeydown,this);return a},onDocKeydown:function(a){var b=this.layers[this.layers.length-1];if(b&&b.keyEvent)return b.onKeydown(a)}},L=g(window),M=v.Layer=x.create(B,{hidden:l,onViewReady:g.noop,trackZIndex:function(){if(this.z!==r){r+=3;this.mask&&g(this.mask).css("z-index",
r-1);this.frameMask&&g(this.getFrameMask()).css("z-index",r-2);this.jq().css("z-index",r);this.z=r}},keyEvent:l,onKeydown:function(a){if(a.keyCode===27&&!this.cancelEscKeyEvent){this.close();return false}},beforeShow:function(){this.mask&&this._applyMask(l);var a=this.jq().css("position");if(a==="absolute"||a==="fixed")this.trackZIndex();F.add(this);this.autoCenter&&this.center()},afterHide:function(){this.mask&&this._applyMask(false);F.remove(this)},getFrameMask:function(){if(this.frameMaskEl)return this.frameMaskEl;
return this.frameMaskEl=s.forNode('<iframe class="shade-div shade-iframe" frameborder="0"></iframe>')},_applyMask:function(a){var b=this.mask;if(!b||b===l)b=this.mask=s.forNode(s.Mask);var d=L.height();if(a){g(b).height(d).appendTo(n.body);this.frameMask&&g(this.getFrameMask()).height(d).appendTo(n.body);g(window).bind("resize",x.getBind(this,"onMaskWinResize"))}else{g(b).remove();this.frameMask&&g(this.getFrameMask()).remove();g(window).unbind("resize",x.getBind(this,"onMaskWinResize"))}},onMaskWinResize:function(){var a=
this.mask,b=L.height();a&&g(a).height(b);this.frameMask&&g(this.getFrameMask()).height(b);this.autoCenter&&this.center()}});k.reg("Layer",M);v.Switcher=function(a){a&&g.extend(this,a);this.initUI()};k.reg("Switcher",v.Switcher);v.Switcher.prototype={trigMode:"click",initUI:function(){this.items&&this.add(this.items,this.contents)},select:function(a){var b=this.selectedItem;this.autoRecover&&this.clearTimer(1);if(this.selectedCS){b&&g(b).removeClass(this.selectedCS);g(a).addClass(this.selectedCS)}this.onselect&&
this.onselect(a);this.selectedItem=a;if(a.contentEl){var d=a.contentEl;setTimeout(function(){b&&b.contentEl&&B.fly(b.contentEl).display(false).unfly();B.fly(d).display(l).unfly()},0)}},unselect:function(a){this.selectedCS&&g(a).removeClass(this.selectedCS);a.contentEl&&B.fly(a.contentEl).display(false).unfly();this.mouseoutTimer&&this.clearTimer(1);this.selectedItem=null},clearTimer:function(a){if(a!==0){if(this.mouseoutTimer){clearTimeout(this.mouseoutTimer);this.mouseoutTimerFn=this.mouseoutTimer=
false}}else if(this.mouseoverTimer){clearTimeout(this.mouseoverTimer);this.mouseoverTimerFn=this.mouseoverTimer=false}},add:function(a,b){if(a.length)if(b)for(var d=0,i=a.length;d<i;d++)this.add(a[d],b[d]);else{d=0;for(i=a.length;d<i;d++)this.add(a[d])}else{d=g(a);var o=this;if(d.hasClass(this.selectedCS)){this.selectedItem&&this.unselect();this.selectedItem=a}if(b)a.contentEl=b;if(this.trigMode==="hover"||this.autoRecover)d.hover(function(){o.autoRecover&&o.mouseoutTimer&&o.clearTimeout(1);if(o.trigMode===
"hover")if(this!==o.selectedItem)if(o.delaySelect){o.mouseoverTimer&&o.clearTimeout(0);o.mouseoverTimer=setTimeout(function(){o.select(a)},o.delaySelect)}else o.select(this);return!o.enableBubble},function(z){o.mouseoverTimer&&o.clearTimeout(0);if(o.trigMode==="hover"){if(this!==o.selectedItem&&o.mouseoutTimerFn){o.mouseoutTimerFn();o.mouseoutTimerFn=null}z=z.target;var C=B.fly(this);if(o.autoRecover&&(z===this||C.ancestorOf(z)))if(!o.mouseoutTimer){var H=this;o.mouseoutTimerFn=function(){o.unselect(H)};
o.mouseoutTimer=setTimeout(o.mouseoutTimerFn,o.delayHide||500)}C.unfly()}return!o.enableBubble});if(this.trigMode==="click")d.bind(this.clickEvent||"mousedown",function(){o.select(this)})}}};v.Box=k.reg("Box",x.create(v.Layer,{view:"Box"}));v.Tip=k.reg("Tip",x.create(v.Box,{cs:"win-fixed",autoHide:l,timeoutHide:500,stayHover:false,offX:25,offY:-10,innerViewReady:function(){var a=this.jq();this.stayHover&&a.hover(x.bind(this.onMouseover,this),x.bind(this.onMouseout,this))},onMouseover:function(){this.clearHideTimer()},
onMouseout:function(){this.setHideTimer()},clearHideTimer:function(){if(this.hideTimerId){clearTimeout(this.hideTimerId);this.hideTimerId=false}},beforeShow:function(){if(M.prototype.beforeShow.apply(this,arguments)===false)return false;this.autoHide&&this.setHideTimer()},setHideTimer:function(){this.clearHideTimer();this.hideTimerId=setTimeout(this._getHideTimerCall(),this.timeoutHide)},_onTimerHide:function(){this.display(false)},_getHideTimerCall:function(){if(!this._onHideTimer)this._onHideTimer=
x.bind(function(){this._onTimerHide();this.clearHideTimer()},this);return this._onHideTimer}}));v.Dialog=k.reg("Dlg",x.create(v.Box,function(a){return{cs:"win-tips win-fixed",contentHtml:"DialogContent",focusBtnCs:"highlight",mask:l,closeable:l,initUI:function(){if(this.buttons&&!this.buttonHtml){for(var b=[],d=0,i=this.buttons,o=i.length;d<o;d++)b.push(s.parse(this.buttonTpl||"Button",i[d]));this.buttonHtml=b.join("")}a.initUI.call(this)},setFocus:function(b){if(b||this.defBtn)this.jq("#xwb_btn_"+
(b||this.defBtn)).focus().addClass(this.focusBtnCs)},afterShow:function(){a.afterShow.call(this);this.defBtn&&this.setFocus()},onbuttonclick:function(b){__debug&&console.log(b+" clicked")},setHandler:function(b){this.onbuttonclick=b;return this},getButton:function(b){return this.jq("#xwb_btn_"+b)},innerViewReady:function(b){a.innerViewReady.call(this,b);var d=this;g(b).find("#xwb_dlg_btns").click(function(i){if(i=x.domUp(i.target,function(z){return z.id&&z.id.indexOf("xwb_btn_")===0},this)){var o=
i.id.substr(8);d.buttons&&g.each(d.buttons,function(){if(this.id===o){var z;if(this.onclick)z=this.onclick(d);if(z!==false&&d["on"+o])z=d["on"+o]();z!==false&&d.onbuttonclick(o)!==false&&d.close()}});return false}})}}}));v.MsgBox=k.reg("msgbox",{getSysBox:function(){var a=this.sysBox;if(!a)a=this.sysBox=k.use("Dlg",{appendTo:n.body,title:"提示",dlgContentHtml:"MsgDlgContent",mask:l,buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"},{title:"&nbsp;是&nbsp;",id:"yes"},{title:"&nbsp;否&nbsp;",
id:"no"},{title:"关&nbsp;闭",id:"close"}],setContent:function(b){this.jq("#xwb_msgdlg_ct").html(b)},setIcon:function(b){var d=a.jq("#xwb_msgdlg_icon");d.attr("className",d.attr("className").replace(/icon\-\S+/i,"icon-"+b))},afterHide:function(){v.Dialog.prototype.afterHide.call(this);this.onbuttonclick=v.Dialog.prototype.onbuttonclick}});return a},getTipBox:function(){var a=this.tipBox;if(!a)a=this.tipBox=k.use("Tip",{cs:"win-tips win-fixed",contentHtml:"DialogContent",appendTo:n.body,view:"Box",title:"提示",
timeoutHide:1200,dlgContentHtml:"MsgDlgContent",setContent:function(b){this.jq("#xwb_msgdlg_ct").html(b)},setIcon:function(b){var d=a.jq("#xwb_msgdlg_icon");d.attr("className",d.attr("className").replace(/icon\-\S+/i,"icon-"+b))},afterHide:function(){v.Tip.prototype.afterHide.call(this);if(this.onhide){this.onhide();this.onhide=false}}});return a},getAnchorDlg:function(){var a=this._anchorDlg;if(!a)a=this._anchorDlg=k.use("Dlg",{cs:"win-tips-ask",mask:false,dlgContentHtml:"AnchorDlgContent",appendTo:n.body,
defBtn:"ok",buttons:[{title:"确&nbsp;定",id:"ok"},{title:"取&nbsp;消",id:"cancel"}],setAnchor:function(b){this.anchorEl=b;return this},beforeShow:function(){v.Dialog.prototype.beforeShow.call(this);if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(d){d[1]-=2});var b=this;this.slide("bc",l,function(){v.Dialog.prototype.afterShow.call(b)})}},afterShow:g.noop,beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else v.Dialog.prototype.beforeHide.call(this)},
afterHide:function(){v.Dialog.prototype.afterHide.call(this);this.onbuttonclick=v.Dialog.prototype.onbuttonclick}});return a},getAnchorTip:function(){var a=this._anchorTip;if(!a)a=this._anchorTip=k.use("Tip",{view:"Box",cs:"operate-success",contentHtml:"AnchorTipContent",appendTo:n.body,timeoutHide:1800,setAnchor:function(b){this.anchorEl=b;return this},beforeShow:function(){if(this.anchorEl){this.anchor(this.anchorEl,"tc",function(b){b[1]-=8});this.slide("bc",l)}v.Tip.prototype.beforeShow.call(this)},
beforeHide:function(){if(this.anchorEl){this.slide("cb",false);delete this.anchorEl;return false}else v.Tip.prototype.beforeHide.call(this)}});return a},tipError:function(a,b){this.tip(a,"error",b)},tipOk:function(a,b){this.tip(a,"success",b)},tipWarn:function(a,b){this.tip(a,"alert",b)},anchorTipOk:function(a,b){this.anchorTip(a,b)},anchorConfirm:function(a,b,d){this.getAnchorDlg().setTitle(b).setHandler(d).setAnchor(a).display(l)},tip:function(a,b,d){var i=this.getTipBox();i.setIcon(b||"alert");
i.setContent(a||"");i.display(l);d&&(i.onhide=d)},anchorTip:function(a,b){this.getAnchorTip().setTitle(b).setAnchor(a).display(l)},alert:function(a,b,d,i,o,z){var C=this.getSysBox(),H=C.buttons,I=B.fly(C.view);i||(z=i="ok");o||(o="alert");for(var K=0,J=H.length;K<J;K++)I.fly(C.jq("#xwb_btn_"+H[K].id).get(0)).display(i.indexOf(H[K].id)>=0);I.unfly();C.defBtn=z;a&&C.setTitle(a);b&&C.setContent(b);o&&C.setIcon(o);d&&(C.onbuttonclick=d);C.display(l);return C},confirm:function(a,b,d,i){this.alert(a||"提示",
b,d,"ok|cancel","ask",i||"ok")},success:function(a,b,d,i,o){this.alert(a,b,d,i||"ok","success",o||"ok")},error:function(a,b,d,i,o){this.alert(a,b,d,i||"ok","error",o||"ok")}})})(Xwb,$);(function(k,g){var q=true,A=parseInt,y=!!(g.browser.msie&&g.browser.version=="6.0"),w=function(){this.cid="imageCtrler";this.canvas=null;this.maxWidth=440;this.curAngle=this.height=this.width=0};w.prototype={init:function(m){m=m.el;this.width=m.offsetWidth;this.height=m.offsetHeight;if(g.browser.msie){m.style.filter="progid:DXImageTransform.Microsoft.Matrix()";m.filters.item("DXImageTransform.Microsoft.Matrix").SizingMethod="auto expand";g(m).addClass("narrow-move")}else{this.canvas=g("<canvas></canvas>").attr({height:this.height,
width:this.width}).addClass("narrow-move").attr("rel","e:zo").insertBefore(m)[0];if(this.canvas.getContext){g(m).hide();this.canvas.getContext("2d")}}this.element=m},rotate:function(m){if(this.element){if(m==="right"){m=this.curAngle+90;this.curAngle=m>=360?0:m}else if(m==="left"){m=this.curAngle-90;this.curAngle=m<0?360+m:m}var l,n;m=this.width;var r=this.height;this.width=r;this.height=m;if(r>this.maxWidth){m=A(this.maxWidth*m/r);r=this.maxWidth}if(this.canvas){var s=this.canvas.getContext("2d"),
D=this.element,x=0,G=0;g(this.canvas).attr({width:r,height:m});s.clearRect(0,0,r,m);switch(this.curAngle){case 0:G=x=0;l=r;n=m;break;case 90:x=r;G=0;l=m;n=r;break;case 180:x=r;G=m;l=r;n=m;break;case 270:x=0;l=G=m;n=r}s.save();s.translate(x,G);s.rotate(this.curAngle*Math.PI/180);s.drawImage(D,0,0,l,n);s.restore()}else{D=this.curAngle*Math.PI/180;s=Math.cos(D);D=Math.sin(D);x=this.element;x.filters.item("DXImageTransform.Microsoft.Matrix").M11=s;x.filters.item("DXImageTransform.Microsoft.Matrix").M12=
-D;x.filters.item("DXImageTransform.Microsoft.Matrix").M21=D;x.filters.item("DXImageTransform.Microsoft.Matrix").M22=s;switch(this.curAngle){case 0:case 180:l=r;n=m;break;case 90:case 270:l=m;n=r}x.width=l;x.height=n;if(g.browser.version==8)x.parentNode.style.height=x.offsetHeight+18}}}};g.extend(g.fn,{zoomText:function(m,l){this.each(function(){var n,r=g(this),s=r.offset(),D=r.text();l=isNaN(l)?2:l;isNaN(+D)||(D=+D+(m||1));r.text(D);n=r.clone().attr("id","").css({position:"absolute",top:s.top,left:s.left,
font:r.css("font"),color:r.css("color")}).appendTo(g(document.body));D=l*parseInt(r.css("font-size"));n.animate({"font-size":D,top:s.top-r.height()/4,left:s.left-r.width()/2,opacity:0.1},{duration:300,complete:function(){n.remove()}})});return this},imgRotate:function(m){this.each(function(){if(this.tagName!=="IMG")return false;var l=g(this).data("img");if(!l){l=new w;l.init({el:this});l.maxWidth=g(this).parent().width();g(this).data("img",l)}l.rotate(m)});return this},focusText:function(m,l,n,r){this.each(function(){g(this).focus(function(){if(this.value===
m){var s=g(this).data("xwb_selholder");if(s)s.setText("");else this.value=""}if(l)r?g(n||this).removeClass(l):g(n||this).addClass(l)}).blur(function(){if(g.trim(this.value)===""){var s=g(this).data("xwb_selholder");if(s)s.setText(m);else this.value=m}if(l)r?g(n||this).addClass(l):g(n||this).removeClass(l)})})},cssDisplay:function(m){var l=this.length,n;if(l)if(l===1){n=k.ui.Base.fly(this[0]);if(m===undefined){l=n.display();n.unfly();return l}else n.display(m).unfly()}else{n=k.ui.Base.fly();this.each(function(){n.fly(this).display(m)});
n.unfly()}return this},substrText:function(m,l){var n=RegExp("(?:<a.*?>.*?<\\/a>)|(?:<img.*?>)|.","gi");this.each(function(){var r=r||"...",s=this.innerHTML;s=s.match(n);m=m||10;if(s&&s.length>m){s=s.slice(0,m).join("");s=l?s:s.replace(/<img.*?title=\"(.*?)\".*?>/gi,"[$1]");g(this).html(s+r)}});return this},fixPng:function(){y&&this.each(function(){if(this.tagName=="IMG"){var m=g("<span></span>").css({width:this.offsetWidth,height:this.offsetHeight,display:"inline-block"});m[0].style.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+
this.src+'", sizingMethod="scale")';g(this).replaceWith(m)}});return this}});(function(){function m(){s=/INPUT|IMG|SCRIPT|STYLE|HEAD|MAP|AREA|TEXTAREA|SELECT|META|OBJECT|IFRAME/i;D=/^\s+$/;x=/(\.|\\|\/|\*|\?|\+|\[|\(|\)|\]|\{|\}|\^|\$|\|)/g;G=/</g;N=/>/g;c=q}function l(e,h){c||m();if(typeof e==="string")e=g.trim(e).split(D);for(var j=[],p=0,t=e.length;p<t;p++)if(e[p]&&!D.test(e[p]))j[j.length]=e[p].replace(G,"&lt;").replace(N,"&gt;").replace(x,"\\$1");var u=RegExp("("+j.join("|")+")","gi"),v='<span class="'+
(h||l.cls)+'">$1</span>',B=document.createElement("DIV");this.each(function(){n(this,u,v,B)});return this}function n(e,h,j,p){var t=e.childNodes,u=[],v,B;v=0;for(B=t.length;v<B;v++)s.test(t[v].tagName)||u.push(t[v]);v=0;for(B=u.length;v<B;v++){t=u[v];if(t.nodeType===3)try{t=t;var E=h,F=j,L=p,M=t.data;if(!D.test(M)){M=M.replace(G,"&lt;").replace(N,"&gt;");if(E.test(M)){L||(L=document.createElement("DIV"));L.innerHTML=M.replace(E,F);var a=L.childNodes;E=[];var b=document.createDocumentFragment();F=
0;for(var d=a.length;F<d;F++)E[F]=a[F];for(F=0;F<d;F++)b.appendChild(E[F]);t.parentNode.replaceChild(b,t)}}}catch(i){}else arguments.callee(t,h,j,p)}}function r(e,h){var j=e.childNodes,p=[],t,u,v;t=0;for(u=j.length;t<u;t++)s.test(j[t].tagName)||p.push(j[t]);t=0;for(u=p.length;t<u;t++){j=p[t];v=j.nodeType;if(v!==3)if(v===1&&j.tagName==="SPAN"&&j.className===h){v=j.childNodes[0];var B=j.parentNode,E=j.previousSibling,F=j.nextSibling;if(E&&E.nodeType===3){B.removeChild(E);v.data=E.data+v.data}if(F&&
F.nodeType===3){B.removeChild(F);v.data+=F.data}B.replaceChild(v,j)}else arguments.callee(j,h)}}var s,D,x,G,N,c;g.fn.highlight=l;g.fn.clearHighlight=function(e){c||m();e=e||l.cls;this.each(function(){r(this,e)})};l.cls="search-txt"})();g.cookie=function(m,l,n){if(typeof l!="undefined"){n=n||{};if(l===null){l="";n.expires=-1}var r="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){if(typeof n.expires=="number"){r=new Date;r.setTime(r.getTime()+n.expires*24*60*60*1E3)}else r=n.expires;
r="; expires="+r.toUTCString()}var s=n.path?"; path="+n.path:"",D=n.domain?"; domain="+n.domain:"";n=n.secure?"; secure":"";document.cookie=[m,"=",encodeURIComponent(l),r,s,D,n].join("")}else{l=null;if(document.cookie&&document.cookie!=""){n=document.cookie.split(";");for(r=0;r<n.length;r++){s=jQuery.trim(n[r]);if(s.substring(0,m.length+1)==m+"="){l=decodeURIComponent(s.substring(m.length+1));break}}}return l}}})(Xwb,jQuery);(function(k,g){var q=true,A=null,y=k.ui,w=k.util,m=document,l=y.Base,n=k.Tpl,r=k.request,s=k.use("msgbox"),D=k.getCfg,x=k.getUid,G=k.getWb,N=k.setWb;y.Emotion=k.reg("emotion",function(){var c=k.use("Box",{contentHtml:"Loading",boxOutterHtml:"ArrowBoxBottom",cs:"win-emotion",appendTo:m.body,closeable:q,actName:"em",contextable:q,actionMgr:q,emotions:A,$categorySelected:A,$categoryShowed:A,cateMaps:{},onactiontrig:function(e){switch(e.data.e){case "em":if(this.onselect)if(this.onselect(this.findEmotionText(e),
e)===false)break;this.display(false);break;case "sc":this.emSwitch(e.data.idx,e.src)}},setHandler:function(e){this.onselect=e;return this},setSelectionHolder:function(e,h,j){this.setHandler(function(p){e.insertText(p);h&&h.call(j||this,e,p)});return this},showAt:function(e){e=g(e).offset();e.left-=22;e.top+=20;this.offset(e).display(q)},initEmotion:function(e){if(e.isOk()){e=e.getData();var h={},j=[],p=[],t=0,u={};g.each(e,function(B,E){if(E.type=="face"){var F=E.category?E.category:"默认";if(h[F])h[F].push(E);
else{h[F]=[E];u[t]=h[F];p.push(['<a href="#" rel="e:sc,idx:',t,'">',F,"</a>"].join(""));t++}E.is_hot&&j.push(['<a href="#" rel="e:em" title="',E.phrase,'"><img width="22px" height="22px" src="',E.url,'" /></a>'].join(""))}});var v=[];g.each(h["默认"],function(B,E){v.push(['<a href="#" rel="e:em" title="',E.phrase,'"><img width="22px" height="22px" src="',E.url,'" /></a>'].join(""))});if(j.length>15)j=j.slice(0,15);e={category:p.join(""),faces:v.join(""),hotList:j.join("")};e=g(n.parse("EmotionBoxContent",
e));this.jq("#xweibo_loading").hide();this.jq("#xwb_dlg_ct").append(e);this.$categorySelected=this.jq("#cate>a:first").addClass("current");this.$categoryShowed=this.jq("#flist0");this.emotions=h;this.cateMaps=u}},createEmArea:function(e){var h=['<div class="e-list" id="flist'+e+'">'];g.each(this.cateMaps[e],function(j,p){h.push(['<a href="#" rel="e:em" title="',p.phrase,'"><img width="22px" height="22px" src="',p.url,'" /></a>'].join(""))});h.push("</div>");return g(h.join(""))},emSwitch:function(e,
h){var j=g(h);if(!j.hasClass("current")){this.$categorySelected.removeClass("current");this.$categorySelected=j.addClass("current");this.$categoryShowed.addClass("hidden");e>0?this.jq("#hotEm").addClass("hidden"):this.jq("#hotEm").removeClass("hidden");j=this.jq("#flist"+e);j.length||(j=this.createEmArea(e).appendTo(this.jq("#box")));this.$categoryShowed=j.removeClass("hidden")}},loadEmotion:function(){var e=this;r.getEmotion(function(h){e.initEmotion(h)})},onViewReady:function(){this.loadEmotion()},
onInputRecev:function(){},findEmotionText:function(e){return e.src.title}});k.reg("emotion",c,q);return c});y.ForwardBox=k.reg("forwardBox",function(){var c=k.use("Dlg",{cs:"win-forward",appendTo:m.body,autoCenter:q,dlgContentHtml:"ForwardDlgContentHtml",title:"转发到我的微博",defBtn:"forward",buttons:[{title:"转 发",id:"forward"},{title:"取 消",id:"cancel"}],checkText:function(){var e=g.trim(this.jqInputor.val()),h=w.calWbText(e);h>=0?this.jqWarn.html("您还可以输入"+h+"字").removeClass("out140"):this.jqWarn.html("已超出"+
Math.abs(h)+"字").addClass("out140");return h>=0&&e},onViewReady:function(){this.jq("#xwb_face_trig").click(w.bind(this.onFaceTrig,this));this.jqInputor=this.jq("#xwb_fw_input");this.jqWarn=this.jq("#xwb_warn_tip");this.jqContent=this.jq("#xwb_forward_text");this.jqLabelCt=this.jq("#xwb_fw_lbl");this.jqInputor.bind("keyup",w.bind(this.onInputorKeyup,this));this.selectionHolder=k.use("SelectionHolder",{elem:this.jqInputor[0]})},onInputorKeyup:function(){this.checkText()},onFaceTrig:function(e){k.use("emotion").setSelectionHolder(this.selectionHolder,
this.checkText,this).showAt(e.target);return false},setContent:function(e,h,j){this._predCfg={id:e,data:h,uid:j};this.jq();var p=[];j!==h.u.id&&p.push(n.parse("ForwardDlgLabel",{uid:e,nick:h.u.sn}));var t=h.rt;if(t){e=t.tx;h="//@"+h.u.sn+":"+h.tx;t.u.id!=j&&p.push(n.parse("ForwardDlgLabel",{uid:t.id,nick:t.u.sn}))}else{e=h.tx;h=""}this.jqContent.text(w.escapeHtml(e));this.selectionHolder.setText(h);this.checkText();this.jqLabelCt.html(p.join(""));return this},submit:function(){if(this.isLoading)return false;
this.isLoading=q;var e=this.checkText();if(e==="")e="转发微博";else if(!e){this.jqInputor.focus();return this.isLoading=false}var h=[];this.jq('input[type="checkbox"]:checked').each(function(){h[h.length]=g(this).val()});var j=this._predCfg;w.disable(this.getButton("forward"),q);r.repost(j.id,e,h.join(","),w.getBind(this,"onSubmitLoad"))},onSubmitLoad:function(e){w.disable(this.getButton("forward"),false);this.close();e.isOk()?s.tipOk("转发成功"):s.tipError(e.getMsg());this.isLoading=false},onbuttonclick:function(e){if(e===
"forward"){this.submit();return false}}});k.reg("forwardBox",c,q);return c});y.getFlash=function(c,e){var h=g.browser.msie;c=c||{};var j='<object width="'+c.width+'" height="'+c.height+(c.id?'" id="'+c.id:"")+(c.name?'" name="'+c.name:"")+'"';if(c.nocache)c.src+=(c.src.indexOf("?")!=-1?"&":"?")+Math.random();j+=c.w3c||h?' data="'+c.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';j+=">";if(c.w3c||h)j+='<param name="movie" value="'+c.src+'" />';c.width=
c.height=c.id=c.w3c=c.src=A;c.onFail=c.version=c.expressInstall=A;for(var p in c)if(c[p])j+='<param name="'+p+'" value="'+c[p]+'" />';h="";if(e){for(var t in e)if(e[t]){p=e[t];h+=t+"="+(/function|object/.test(typeof p)?f.asString(p):p)+"&"}h=h.slice(0,-1);j+='<param name="flashvars" value=\''+h+"' />"}j+="</object>";return j};y.WbElement=k.reg("WbElement",w.create(l,{init:function(){l.prototype.init.apply(this,arguments);this.picLoadState=0;this.isFw=this.wbData.rt?1:0;this.$preview=this.$wb.find("div.preview-img")},
playVideo:function(c){c.get("w");c=c.get("i");c=D("urls")[c];var e=this.$wb.find("div.feed-content").width()-35,h=parseInt(e/1.25);h=y.getFlash({src:c.flash,width:e,height:h,w3c:1,id:"sinaVideo_"+ +new Date,quality:"high",allowScriptAccess:"always",wmode:"transparent",allowFullscreen:"TRUE",flashvars:"playMovie=TRUE"});this.$video&&this.$video.remove();var j;if(this.isFw){e="div.forward>p";j="VideoBoxForward"}else{e="p.feed-main";j="VideoBox"}c=n.parse(j,{href:c.url,title:c.title,flash:h});this.$video=
g(c).insertAfter(this.$wb.find(e));this.switchView("video",1)},closeVideo:function(){this.switchView("video",0)},loadPic:function(){this.picLoadState=1;var c=this,e=this.wbData;e=this.isFw?{org:e.rt.op,img:e.rt.mp}:{org:e.op,img:e.mp};var h=this.$thumbImg=this.$wb.find("img.zoom-move");this.$loadEl=g('<div class="loading-img"></div>').appendTo(h.parent());this.$picBox=g(n.parse(this.isFw?"PictureBoxForward":"PictureBox",e));h=this.img=new Image;g(h).bind("load",function(){c.onPicLoaded()}).addClass("narrow-move").attr("rel",
"e:zo").attr("src",e.img)},onPicLoaded:function(){var c=this.$wb.find(this.isFw?"div.forward":"div.feed-content:first"),e=this.img,h=this.$picBox;c.css("visibility","hidden");var j=this.$wb.find("div.feed-content").width()-35;g(e).appendTo(h.find("div[name=img]"));c.children("div.preview-img").after(h);this.switchView("pic",1);if(e.width>j){if(g.browser.msie)e.height*=j/e.width;e.width=j}c.css("visibility","");this.$loadEl.remove();this.picLoadState=2},zoomIn:function(){if(this.picLoadState==0)this.loadPic();
else this.picLoadState==2&&this.switchView("pic",1)},zoomOut:function(){this.switchView("pic",0)},trun:function(c){g(this.img).imgRotate(c)},switchView:function(c,e){if(e){if(c=="pic"){this.$picBox.show();this.$video&&this.$video.remove();this.$video=A}else if(c=="video"){this.$video.show();this.$picBox&&this.$picBox.hide()}this.$preview.hide()}else{if(c=="pic")this.$picBox&&this.$picBox.hide();else if(c=="video"){this.$video&&this.$video.remove();this.$video=A}this.$preview.show()}}}));y.CmtBox=
k.reg("CmtBox",w.create(l,{actionMgr:q,view:"CmtBox",autoH:q,wbUid:A,innerViewReady:function(c){this.wbUid=k.getUid();l.prototype.innerViewReady.call(this,c);this.jqExtra("inputor","warn","sync");this.selectionHolder=k.use("SelectionHolder",{elem:this.jqInputor[0]});var e=this;this.jqInputor.bind("keyup",function(h){e.onInputorKeyup(h)})},reset:function(){this.getView();this.selectionHolder.setText("");this.jqSync.attr("checked",false);this.checkText()},checkText:function(){var c=this.jqInputor,e=
g.trim(c.val()),h=w.calWbText(e);h>=0?this.jqWarn.html("还可以输入"+h+"字"):this.jqWarn.html("已超出"+Math.abs(h)+"字");this.autoH&&c.height()!==c[0].scrollHeight&&c.css("height",c[0].scrollHeight);return h>=0&&e},send:function(){if(!this.sending){var c=this.checkText();if(c){this.sndBtn&&w.disable(this.sndBtn,q);this.sending=q;var e=this.jqInputor.data("xwb_reply_cid");e&&/^回复@.*?:/.test(c)?r.reply(this.wbId,e,c,this.jqSync.attr("checked")?1:0,1,w.getBind(this,"onSendLoad")):r.comment(this.wbId,c,this.jqSync.attr("checked")?
1:0,1,w.getBind(this,"onSendLoad"))}else setTimeout(w.bind(function(){this.jqInputor.focus()},this),0)}},onSendLoad:function(c){if(c.isOk()){this.pCt.afterSend(c);this.reset();c=c.getData();c.html&&this.pCt.postWeibo(c.wb,c.html)}else s.tipWarn(c.getMsg());this.jqInputor.focus();this.sndBtn&&w.disable(this.sndBtn,false);this.sending=false},reply:function(c,e){var h=this.selectionHolder,j=this.jqInputor;h.setText("回复@"+e+":"+j.val().replace(/^回复@.*?:/,""));j.data("xwb_reply_cid",c);setTimeout(function(){h.focusEnd()},
0)},onFaceTrig:function(c){k.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(c.src);return false},onInputorKeyup:function(){this.checkText()},onactiontrig:function(c){switch(c.data.e){case "ic":this.onFaceTrig(c);break;case "sd":if(!this.sndBtn)this.sndBtn=c.src;this.send()}}}));y.CommentArea=k.reg("CmtArea",w.create(l,{view:"CommentArea",readSize:10,cmtType:1,hdPicSz:30,cmtCount:0,page:1,num:0,cmtBoxHtml:"CmtBox",commentHtml:"Comment",actionMgr:q,cmtBox:"CmtBox",
initUI:function(){this.cmtUrl=r.mkUrl("show","","id="+this.wbId);this.jqExtra("pre");l.prototype.initUI.call(this)},getFromUser:function(){if(!this.wbUid){var c=G(this.wbId);this.wbUid=c&&c.u.id}return this.wbUid},innerViewReady:function(c){l.prototype.innerViewReady.call(this,c);this.jqExtra("cmtCt","more","lefCnt");this.initCmtBox()},decorateLoading:function(){this.isLoading?g(n.get("Loading")).appendTo(this.getView().parentNode):g(this.getView().parentNode).find("#xweibo_loading").remove();this.display(!this.isLoading)},
initCmtBox:function(){this.cmtBox=k.use("CmtBox",{view:this.jq("#cmtBox")[0],wbId:this.wbId,pCt:this});this.cmtBox.getView()},load:function(c){this.getView();this.cmtBox.reset();if(!this.isLoading){this.isLoading=q;this.decorateLoading();c&&(this.onload=c);r.getComments(this.wbId,this.page,this.cmtType,w.getBind(this,"onCmtsLoad"))}},postWeibo:function(c,e){var h=k.use("weiboList");h&&h.append(c.id,c,e)},afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment)));this.jqCmtCt.cssDisplay(q);
this.updateCmtCountUI(1,q)},onCmtsLoad:function(c){if(c.isOk()){this.createListUI(c);var e=c.getData().total;e&&this.updateCmtCountUI(e);this.updateCmtPageUI(c.getData())}this.isLoading=false;this.decorateLoading();this.onload&&this.onload(c)},createListUI:function(c){this.jqCmtCt.empty();var e=c.getData();e=e.total-Math.min(e.limit,e.total);var h=[];c.each(function(j){h[h.length]=this.createCmtUI(j)},this);if(h.length){this.jqCmtCt.html(h.join(""));if(e){this.jqMore.cssDisplay(q);this.jqLefCnt.text(e)}else this.jqMore.cssDisplay(false);
this.jqCmtCt.cssDisplay(q)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}},createCmtUI:function(c){var e=this.getFromUser(),h=x();c.sinaV=c.sina_v;c.usrUrl=r.mkUrl("ta","","id="+c.uid);c.picSz=this.hdPicSz;c.time=c.create_at;if(e===h||c.uid===h)c.canDel=q;return n.parse(this.commentHtml,c)},updateCmtPageUI:function(){this.jqPre.length&&this.jqPre.cssDisplay(this.page!==1)},updateCmtCountUI:function(c,e){if(this.trigEl)if(e===void 0){g(this.trigEl).text("评论("+c+")");this.cmtCount=
c}else{this.cmtCount+=c;g(this.trigEl).text("评论("+this.cmtCount+")")}},onactiontrig:function(c){switch(c.data.e){case "rp":this.onReplyTrig(c);break;case "dl":this.onDelTrig(c);break;case "nx":this.goPage(this.page+1);break;case "pr":this.goPage(this.page-1)}},onDelTrig:function(c){var e=this;s.anchorConfirm(c.src,"确定要删除该评论吗？",function(h){if(h==="ok"&&!e.deletingCmt){e.deletingCmt=q;r.delComment(c.get("c"),function(j){var p=c.getEl("c");if(j.isOk()){g(p).remove();e.updateCmtCountUI(-1,q);e.cmtCount==
0&&e.cmtBox.jqInputor.focus()}else s.tipError(j.getMsg());e.deletingCmt=false})}})},onReplyTrig:function(c){var e=c.get("c");c=c.get("n");this.cmtBox.reply(e,c)},goPage:function(c){this.page=c;this.load()}}));y.MBlogCmtArea=k.reg("MBlogCmtArea",w.create(y.CommentArea,{commentHtml:"MBlogCmt",cmtType:2,createListUI:function(c){this.jqCmtCt.empty();c.getData();var e=[],h=this.faceSize;c.each(function(j){if(h)j.profileImg=j.profileImg.replace("/30/","/"+h+"/");e[e.length]=this.createCmtUI(j)},this);if(this.num=
e.length){this.jqCmtCt.html(e.join(""));this.jqCmtCt.cssDisplay(q)}else{this.jqCmtCt.cssDisplay(false);this.jqMore.cssDisplay(false)}},initCmtBox:function(){this.cmtBox=k.use("CmtBox",{wbId:this.wbId,pCt:this,view:"MBCmtBox"});this.cmtBox.getView();this.topCmtBox=k.use("CmtBox",{wbId:this.wbId,pCt:this,autoH:false,view:this.topCmtBox});this.topCmtBox.getView()},updateCmtCountUI:g.noop,onReplyTrig:function(c){this.cmtBox.jq().insertAfter(c.jq("c").find("#trigs"));var e=c.get("c");c=c.get("n");this.cmtBox.display(q).reply(e,
c)},postWeibo:g.noop,afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment))).cssDisplay(q);this.cmtBox.display(false);this.topCmtBox.jqInputor.focus()},onload:function(){var c=this.jq("#pager");g(c).removeClass("hidden");this.topCmtBox.jqInputor.focus()}}));y.MyCmt=k.reg("MyCmt",w.create(l,{actionMgr:q,innerViewReady:function(c){l.prototype.innerViewReady.call(this,c);this.jqExtra("cmtCt");var e=this;this.jqCmtCt.find("li").each(function(){g(this).hover(e.onItemMouseover,
e.onItemMouseout)})},onItemMouseover:function(){var c=g(this).data("dlEl");if(!c){c=g(this).find("a[rel=e:dl]");g(this).data("dlEl",c)}c.cssDisplay(q)},onItemMouseout:function(){var c=g(this).data("dlEl");if(!c){c=g(this).find("a[rel=e:dl]");g(this).data("dlEl",c)}c.cssDisplay(false)},onactiontrig:function(c){switch(c.data.e){case "sa":this.selectAll(c.src.checked);c.preventDefault(false);break;case "da":this.delSelected();break;case "rp":var e=c.jq("c","#cmtBoxCt"),h=c.get("c"),j=c.get("w");c=c.get("n");
this.getCmtBox().jq().insertAfter(e);this.reply(j,h,c);break;case "dl":this.delCmt(c.get("c"),c.src)}},afterSend:function(c){this.jqCmtCt.prepend(g(this.createCmtUI(c.getData().comment))).cssDisplay(q);this.cmtBox.display(false)},postWeibo:g.noop,selectAll:function(c){this.jq("li label input:checkbox[rel=cdl],input:checkbox[rel=e:sa]").each(function(){if(!this.disabled)this.checked=c})},delSelected:function(){var c=[],e=k.use("action"),h=this.jqCmtCt[0];this.jqCmtCt.find("li label input:checkbox[rel=cdl]").each(function(){this.checked&&
c.push(e.getRel(this,"c",h))});c.length&&s.confirm("","确定删除所有选择评论？",w.bind(function(j){j=="ok"&&r.delComment(c.join(","),function(){location.reload()})},this))},getCmtBox:function(){if(!this.cmtBox){this.cmtBox=k.use("CmtBox",{pCt:this,view:"MBCmtBox"});this.cmtBox.getView()}return this.cmtBox},reply:function(c,e,h){var j=this.getCmtBox();j.wbId=c;j.selectionHolder.setText("");j.jqInputor.css("height","");j.display(q).reply(e,h)},delCmt:function(c,e){s.anchorConfirm(e,"确定要删除该回复吗？",function(h){h==
"ok"&&r.delComment(c,function(){location.reload()})})},createCmtUI:function(){s.tipOk("回复成功！")}}));y.VideoBox=k.reg("videoBox",function(){var c=k.use("Box",{cs:" win-insert",contentHtml:"MediaBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:m.body,actionMgr:q,closeable:q,contextable:q,onViewReady:function(){this.jqInputor=this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=k.use("SelectionHolder",{elem:this.jqInputor[0]})},onactiontrig:function(e){switch(e.data.e){case "ok":if(e=
this.checkText()){this.onselect&&this.onselect(e);this.close()}else this.jqInputor.focus();break;case "cc":this.close();break;case "nm":this.onselect&&this.onselect(g.trim(this.jqInputor.val()));this.close()}},checkText:function(){var e=this.jqInputor,h=this.selectionHolder,j=g.trim(e.val());if(j==""||j=="http://"){setTimeout(function(){e.focus();h.setText("http://");e.select()});return false}else if(!this.checkUrl(j)){this.jqTip.cssDisplay(q);return false}return j},checkUrl:function(e){return e.indexOf("http://")===
0},showAt:function(e,h){this.onselect=h;var j=g(e).offset();j.left-=140;j.top+=20;this.offset(j).display(q);var p=this;setTimeout(function(){p.selectionHolder.setText("http://");p.jqInputor.focus();p.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}});k.reg("videoBox",c,q);return c});y.MusicBox=k.reg("musicBox",function(){return k.use("Box",{cs:" win-insert",contentHtml:"MusicBoxContentHtml",boxOutterHtml:"ArrowBoxBottom",appendTo:m.body,closeable:q,actionMgr:q,contextable:q,onViewReady:function(){this.jqInputor=
this.jq("#xwb_inputor");this.jqTip=this.jq("#xwb_err_tip");this.selectionHolder=k.use("SelectionHolder",{elem:this.jqInputor[0]})},checkText:function(){var c=this.jqInputor,e=g.trim(c.val()),h=this.selectionHolder;if(e==""||e=="http://"){setTimeout(function(){c.focus();h.setText("http://");c[0].select()});return false}else if(!this.checkUrl(e)){this.jqTip.cssDisplay(q);return false}return e},checkUrl:function(c){return c.indexOf("http://")===0},onactiontrig:function(c){switch(c.data.e){case "ok":if(c=
this.checkText()){this.onselect&&this.onselect(c);this.close()}else this.jqInputor.focus();break;case "cc":this.onselect&&this.onselect();this.close();break;case "nm":this.onselect&&this.onselect(g.trim(this.jqInputor.val()));this.close()}},showAt:function(c,e){this.onselect=e;var h=g(c).offset();h.left-=140;h.top+=20;this.offset(h).display(q);var j=this;setTimeout(function(){j.selectionHolder.setText("http://");j.jqInputor.focus();j.jqInputor[0].select()},0);this.jqTip.cssDisplay(false)}})});y.PostBase=
{actionMgr:q,initEx:function(){var c=this.jqInputor=this.jq("#xwb_inputor"),e=this.jqSendBtn=this.jq("#xwb_send_btn"),h=c.parent();this.jqWarn=this.jq("#xwb_word_cal");this.jqImgFile=this.jq("#xwb_img_file");this.jqBtnImg=this.jq("#xwb_btn_img");this.jqUploadTip=this.jq("#xwb_upload_tip");this.jqPhotoName=this.jq("#xwb_photo_name");this.jqForm=this.jq("#xwb_post_form");this.selectionHolder=k.use("SelectionHolder",{elem:this.jqInputor[0]});var j=this;this.jqImgFile.change(function(p){j.onImgFileChange(p)});
this.btnHoverCS&&e.hover(function(){e.addClass(j.btnHoverCS)},function(){e.removeClass(j.btnHoverCS)});c.bind("keyup",function(p){j.onInputorKeyup(p)}).bind("focus",function(){h.addClass("post-focus")}).bind("blur",function(){h.removeClass("post-focus")})},getUploader:function(){if(!this.uploader)this.uploader=k.use("Uploader",{form:this.jqForm[0],action:r.mkUrl("api/weibo/action","upload_pic"),onload:w.getBind(this,"onUploadLoad")});return this.uploader},reset:function(){this.jqUploadTip.cssDisplay(false);
this.jqPhotoName.cssDisplay(false);this.jqBtnImg.cssDisplay(q);this.jqForm.cssDisplay(q);this.jqImgFile.val("");this.selectionHolder.setText("");this.jqForm[0].reset();this.uploadPic=false;this.checkText();return this},onactiontrig:function(c){switch(c.data.e){case "sd":this.post();break;case "ic":k.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(c.src);break;case "vd":k.use("videoBox").showAt(c.src,w.getBind(this,"onBoxTextReturn"));break;case "ms":k.use("musicBox").showAt(c.src,
w.getBind(this,"onBoxTextReturn"));break;case "tp":this.insertTopic();break;case "dlp":this.uploadPic=false;this.jqBtnImg.cssDisplay(q);this.jqForm.cssDisplay(q);this.jqPhotoName.cssDisplay(false);this.jqInputor.focus()}},onBoxTextReturn:function(c){c&&this.selectionHolder.insertText(c);this.checkText()},checkText:function(){var c=g.trim(this.jqInputor.val()),e=w.calWbText(c);e>=0?this.jqWarn.html("您还可以输入<span>"+e+"</span>字").removeClass("out140"):this.jqWarn.html("已超出<span>"+Math.abs(e)+"</span>字").addClass("out140");
return e>=0&&c},checkImg:function(c){c=c.split(".");return c.length&&g.inArray(c.pop().toLowerCase(),["jpg","png","gif","jpeg"])!==-1},onInputorKeyup:function(){this.checkText()},TOPIC_TIP:"请在这里输入自定义话题",insertTopic:function(c){if(!c)c=this.TOPIC_TIP;var e=this.jqInputor[0],h=RegExp("#"+this.TOPIC_TIP+"#").test(e.value),j=c,p=0,t=0;e.focus();if(document.selection){var u=document.selection.createRange();j=u.text||c;if(j==c&&h){p=RegExp.leftContext.length+1;t=c.length}else if(j==c){u.text="#"+c+"#";
p=e.value.indexOf("#"+c+"#")+1;t=c.length}else u.text="#"+j+"#";if(j==c){u=e.createTextRange();u.collapse();u.moveStart("character",p);u.moveEnd("character",t)}u.select()}else if(e.selectionStart||e.selectionStart=="0"){p=e.selectionStart;t=e.selectionEnd;if(p!=t)j=e.value.substring(p,t);if(h&&j==c){p=RegExp.leftContext.length+1;t=p+j.length}else if(j==c){e.value=e.value.substring(0,p)+"#"+j+"#"+e.value.substring(t,e.value.length);p++;t=p+j.length}else{e.value=e.value.substring(0,p)+"#"+j+"#"+e.value.substring(t,
e.value.length);t=p=p+j.length+2}e.selectionStart=p;e.selectionEnd=t}else e.value+="#"+j+"#";this.checkText();this.selectionHolder.saveSpot()},post:function(){var c=this.checkText();if(c)if(this.getUploader().isLoading())s.tipWarn("图片正在上传，请稍候..");else if(this.sending)s.tipWarn("正在发布,请稍候..");else{this.sending=q;r.post(c,w.getBind(this,"onSendLoad"),this.uploadPic)}else this.jqInputor.focus()},onImgFileChange:function(){var c=this.jqImgFile.val(),e=this;this.uploadPic=A;if(!c||!this.checkImg(c)){this.jqForm[0].reset();
s.alert("","只支持 jpg、png、gif 的图片。",function(){e.jqInputor.focus()})}else{this.jq("#xwb_upload_tip").cssDisplay(q);this.jqForm.cssDisplay(false);this.jqBtnImg.cssDisplay(false);this.getUploader().upload()}},onUploadLoad:function(c){c=r.parseProtocol(c);if(q){this.uploadPic=c.getData().msg;this.jqPhotoName.html(w.getFileName(this.jqImgFile.val(),10)+n.get("UploadImgBtn"));this.jqPhotoName.cssDisplay(q);!g.trim(this.jqInputor.val())&&this.selectionHolder.setText("分享图片");this.checkText()}else{s.alert("",
c.getMsg());this.jqBtnImg.cssDisplay(q);this.jqForm.cssDisplay(q)}this.jqUploadTip.cssDisplay(false);this.jqForm[0].reset();this.jqInputor.focus()},onSendLoad:function(c){var e=this.jqInputor;if(c.isOk()){var h=this.jq("#xwb_succ_mask");h.show().cssDisplay(q);e.focus();h.fadeOut(1800,function(){h.cssDisplay(false);h[0].style.display="";h[0].style.filter=""});this.reset();var j=k.use("weiboList");if(j){var p=c.getData();g.each(p.data,function(t,u){j.append(t,u,p.html)})}}else s.alert("",c.getMsg(),
function(){w.focusEnd(e[0])});this.sending=false}};k.reg("postBox",function(){var c=g.extend({},y.PostBase);g.extend(c,{title:"发微博",closeable:q,autoCenter:q,appendTo:m.body,mask:q,cs:"win-post",contentHtml:"PostBoxContent",onViewReady:function(){this.initEx()},onbuttonclick:function(e){if(e=="ok"){this.post();return false}},onSendLoad:function(e){y.PostBase.onSendLoad.call(this,e);if(e.isOk()){var h=this;setTimeout(function(){h.close();h.jq("#xwb_succ_mask").hide().cssDisplay(false)},500)}}});c=k.use("Box",
c);k.reg("postBox",c,q);return c});y.WeiboList=k.reg("WeiboList",w.create(l,{ctNode:"#xwb_weibo_list_ct",innerViewReady:function(c){l.prototype.innerViewReady.call(this,c);this.jqCt=this.jq(this.ctNode);this.wbList=G()},append:function(c,e,h){this.item(c,e);if(h){h=g.trim(h);var j=this;g(h).prependTo(this.jqCt).hide().fadeIn(1E3,function(){var p={};p[c]=e;j.renderLink(p)})}},item:function(c,e){if(e===void 0)return G(c);N(c,e)},renderLink:function(c){y.linkRender(c)}}));y.SearchEntry=k.reg("SearchEntry",
w.create(l,{focusText:"搜索微博/找人",focusCs:"search-box-focus",maxLen:30,innerViewReady:function(c){l.prototype.innerViewReady.call(this,c);c=this.jqInputor=this.jq("#xwb_inputor");var e=this;this.jq("#xwb_trig").click(function(){return e.submit()});c.keydown(function(h){h.keyCode===13&&e.submit()});this.focusText&&c.focusText(this.focusText,this.focusCs,this.getView())},submit:function(){var c=g.trim(this.jqInputor.val());if(c==this.focusText)c="";if(c){c=encodeURIComponent(w.byteCut(c,this.maxLen));
c=r.mkUrl("search","","k="+c);window.location.href=c}else this.jqInputor.focus()}}));(function(){function c(e){e=e||G();var h={urls:[],map:{}},j;if(e){var p=h.map,t=h.urls,u=/http:\/\/sinaurl\.cn\/([0-9a-z]+)/gi,v;for(v in e)g.each([e[v],e[v].rt],function(B,E){if(E)for(var F=E.tx;u.test(F);){j=RegExp.$1;p[j]||(p[j]=[]);t.push(j);p[j].push([v,B])}})}return h.urls.length?h:A}y.linkRender=function(e){var h=c(e);h&&r.sinaurl(h.urls.join(","),function(j){var p=k.cfg;if(j.isOk()){j=j.raw.data;var t=h.map;
if(p.urls)g.each(j,function(u,v){p.urls[u]=v});else p.urls=j;g.each(j,function(u,v){g.each(t[u],function(B,E){var F=E[1],L=g("div.feed-list>ul>li[rel=w:"+E[0]+"]"),M=v.type,a="http://sinaurl.cn/"+u;L=g(L);var b=L.find("div.forward"),d=L.find("p.feed-main");a=F?b.next("p").find("a[href="+a+"]"):d.find("a[href="+a+"]");switch(M){case "music":a.attr("title",v.url).addClass("icon-music-url icon-bg");break;case "video":a.attr("title",v.title).addClass("icon-video-url icon-bg");if(F){M=b.find(">div.preview-img");
M.length||g(n.parse("PreviewBox")).appendTo(b)}else{M=d.next("div.preview-img");M.length||g(n.parse("PreviewBox")).insertAfter(d)}if(F||!F&&!b.length){a.attr("rel","e:pv,i:"+u);M=n.parse("VideoThumbHtml",{img:v.screen,id:u});g(M).appendTo(L.find((F?"div.forward ":"")+"div.preview-img"))}break;default:a.attr("title",v.url)}})})}})}})();k.reg("myMsg",function(){var c=k.use("Box",function(e){return{contentHtml:"PrivateMsgContent",appendTo:m.body,cs:"win-mes",actionMgr:q,title:"发私信",autoCenter:q,closeable:q,
mask:q,onViewReady:function(){var h=this;this.jqExtra("word","warn","sender","content","warnPos","uid");this.jqContent.keyup(w.bind(this.checkText,this));this.jqSender.blur(function(){var j=g.trim(this.value);h.checkFans(j,1,A,q)});this.selectionHolder=k.use("SelectionHolder",{elem:this.jqContent[0]})},checkText:function(){var h=g.trim(this.jqContent.val()),j=w.calWbText(h,300);this.jqWord.html(j>=0?"您还可以输入"+j+"个字":"已超出"+Math.abs(j)+"字");return j>=0&&h},afterShow:function(){e.afterShow.call(this);
this.jqSender.val()===""?this.jqSender.focus():this.jqContent.focus()},onactiontrig:function(h){switch(h.data.e){case "sd":this.send();break;case "ic":k.use("emotion").setSelectionHolder(this.selectionHolder,this.checkText,this).showAt(h.src)}},send:function(){if(!this.sending){var h=this.validate(),j=w.getBind(this,"onSendLoad"),p=this.jqSendBtn;h&&this.checkFans(h.u,h.t,function(){w.disable(p,q);r.msg(h.u,h.t,h.c,j)})}},onSendLoad:function(h){if(h.isOk()){this.display(false);location.reload()}else{var j;
switch(h.getCode()){case 20014:s.alert("",h.getMsg());break;default:j=h.getMsg()}j&&this.display()&&this.jqWarnPos.cssDisplay(q).text(j)}this.sending=false;w.disable(this.jqSendBtn,false)},checkFans:function(h,j,p,t){var u=this;h?r.followed(h,function(v){if(v.isOk())if(v.getData()){u.jqWarnPos.cssDisplay(false);p&&p.call(this,v)}else{u.jqWarnPos.cssDisplay(q).text(r.ERRORMAP["20016"]);!t&&u.jqSender.focus()}else{u.jqWarnPos.cssDisplay(q).text(v.getMsg());!t&&u.jqSender.focus()}},j):u.jqWarnPos.cssDisplay(q).text("请输入要发送的用户昵称。")},
reset:function(){this.jqSender.attr("disabled",false).val("");this.jqContent.val("");this.jqUid.val("");this.jqWarnPos.cssDisplay(false);return this},validate:function(){var h=g.trim(this.jqSender.val()),j=this.checkText(),p=this.jqUid.val();if(h)if(j){if(p)return{u:p,c:j};return{u:h,c:j,t:1}}else{g.trim(this.jqContent.val()).length?alert("内容不能超过300个汉字。"):alert("请输入私信内容。");this.jqContent.focus()}else this.jqSender.focus()},reply:function(h,j){this.getView();this.reset();this.display(q);this.jqSender.val(j).attr("disabled",
q);this.jqUid.val(h);this.jqContent.focus()}}});k.reg("myMsg",c,q);return c});k.reg("notice",function(c){var e=k.use("Layer",function(h){var j=g("#new_wb_tips");return g.extend({view:"NoticeLayer2",hidden:q,closeable:q,actionMgr:q,remindType:1,clearOnClose:q,types:["wbs","refer","cmts","fans","msgs"],interval:3E4,wbsUrl:r.mkUrl("index"),referUrl:r.mkUrl("index","atme"),cmtsUrl:r.mkUrl("index","comments"),msgsUrl:r.mkUrl("index","messages"),fansUrl:r.mkUrl("index","fans"),initUI:function(){if(this.remindType)this.view=
"NoticeLayer";h.initUI.call(this);this.getView();this.interval&&this.doCheck()},push:function(p,t,u){p=this.jq("#"+p);var v=p.find("#c"),B=parseInt(v.text());u||(t+=B);if(t!=B){v.text(t);t>0&&p.cssDisplay(!!t)}if(t&&!this.display())this.display(q);else{u=t=0;for(p=this.types.length;u<p;u++)parseInt(this.jq("#"+this.types[u]).find("#c").text())==0&&t++;t==p&&this.display(false)}},onclose:function(){this.clearOnClose&&this.clearUnread()},clearUnread:function(){var p=this;g.each(this.types,function(){var t=
p.jq("#"+this);t.cssDisplay(false);t.find("#c").text("0")});r.clearUnread("",g.noop)},latestWid:0,doCheck:function(){if(!this.checking){this.checking=q;r.unread(this.latestWid,w.getBind(this,"oncheckLoad"))}},oncheckLoad:function(p){if(p.isOk()){p=p.getData().unread;for(var t=0,u=this.types.length;t<u;t++)if(t==0){if(j.length)parseInt(p[t])?j.show().css("display","block"):j.hide()}else p[t]&&this.push(this.types[t],p[t],q)}this.checking=false;this.interval&&setTimeout(w.getBind(this,"doCheck"),this.interval)}},
c)});k.reg("notice",e,q);return e});k.reg("skin",function(c){c=k.use("base",g.extend({actionMgr:q,skinSelectedCS:"current",onViewReady:function(){this.tab=k.use("Switcher",this.tab)},onactiontrig:function(e){switch(e.data.e){case "cs":this.change(e.get("sk"),e.get("id"));this.decorateSelected(e.src);break;case "sv":this.using?this.save(this.using):this.display(false);break;case "cc":this.usedSkin&&this.change(this.usedSkin);this.close()}},beforeHide:function(){if(g.browser.msie){var e=k.Cache.get("div");
g("#wrapper").css("clear","both");k.Cache.put(e)}},change:function(e,h){var j=this;g("link[rel=stylesheet]").each(function(){if(this.href.indexOf("/skin.css")!==-1){if(!j.usedSkin)j.usedSkin=this.href.match(/\/css\/(.*)\/skin.css/i)[1];this.href=this.href.replace(/\/css\/.*\/skin.css/i,"/css/"+e+"/skin.css")}});this.using=h},save:function(e){var h=this;r.saveSkin(e,function(j){j.isOk()?h.display(false):s.alert("",j.getMsg())})},decorateSelected:function(e){if(!this.jqPreSel)this.jqPreSel=this.jq("#tabPanels ."+
this.skinSelectedCS);this.jqPreSel.removeClass(this.skinSelectedCS);this.jqPreSel=g(e);this.jqPreSel.addClass(this.skinSelectedCS)}},c));k.reg("skin",c,q);return c});y.oAuthLogin={logWin:A,show:function(c){var e=this.logWin,h=this;if(e&&!e.closed)e.focus();else{this.logWin=window.open(r.mkUrl("account","sinaLogin","popup=1&cb="+(c||"")),"logWin","resizable=1,location=0,status=0,scrollbars=0,width=510,height=400");if(!window.loginCallback)window.loginCallback=function(j){h.logWin.close();if(j)window.location.href=
j;else{j=k.getCfg("page");if(!j.indexOf("pub")||!j.indexOf("index"))window.location.reload();else window.location.href=r.mkUrl("pub")}}}},bind:function(c,e){e=e||"click";var h=this;g(c).bind(e,function(){h.show()})}};y.LoginBox=k.reg("LoginBox",function(){var c=k.use("Box",{contentHtml:"Login",cs:"win-bind-login win-fixed",appendTo:m.body,mask:q,siteName:D("siteName"),siteLoginUrl:r.mkUrl("account","siteLogin"),regUrl:k.getCfg("siteReg"),closeable:q,onViewReady:function(){y.oAuthLogin.bind(this.jq("#oauth"))}});
k.reg("LoginBox",c,q);return c});y.updateCount=function(){var c=[],e=G();g.each(e,function(h,j){c.push(h);j.rt&&c.push(j.rt.id)});c.length&&r.counts(c.join(","),function(h){if(h.isOk()){var j=h.getData();g.each(e,function(p,t){var u=j[p];if(u){var v=g("div.feed-list>ul>li[rel=w:"+p+"]");u[0]&&v.find("#cm").text("评论("+u[0]+")");u[1]&&v.find("#fw").text("转发("+u[1]+")");var B=t.rt;if(B&&(u=j[B.id])){v=v.find("div.forward");u[0]&&v.find("a[rel=l:cm]").each(function(){g(this).text(g(this).text()+"("+u[0]+
")")});u[1]&&v.find("a[rel=l:fw]").each(function(){g(this).text(g(this).text()+"("+u[1]+")")})}}});(h=y.updateCount.hooks)&&g.each(h,function(p,t){t(j)})}})};y.updateCount.hooks=[];y.updateCount.addHook=function(c){g.isFunction(c)&&y.updateCount.hooks.push(c)};y.FadeShow=k.reg("FadeBox",w.create(l,{curr:0,length:0,duration:300,delay:5E3,running:false,runTimer:A,onViewReady:function(){this.$list=g(this.view).children();this.length=this.$list.length;var c=this;g(this.view).mouseover(function(){c.stop()}).mouseout(function(e){e=
e.relatedTarget;if(!e||!g.contains(c.view,e))c.start()});this.start()},start:function(){if(!(this.length<=1))if(!this.runTimer){var c=this;this.runTimer=setTimeout(function(){c.fade()},this.delay);this.running=q}},stop:function(){if(this.runTimer){clearTimeout(this.runTimer);this.runTimer=A}this.running=false},fade:function(){var c=this.curr,e=++this.curr,h=this;if(e>=this.length)this.curr=e=0;var j=g(this.$list[c]),p=g(this.$list[e]);j.animate({opacity:0},{duration:h.duration,complete:function(){j.addClass("next");
p.removeClass("next").css({opacity:0}).animate({opacity:1},{duration:h.duration,complete:function(){h.runTimer=A;h.running&&h.start()}})}})}}));y.FriendList=k.reg("FriendList",w.create(l,function(){return{onViewReady:function(){var c=this,e=g(this.view).children();g.each(e,function(h,j){g(j).mouseover(function(p){var t=c.onMouseOver;p=p.currentTarget;t&&t.call(p)}).mouseout(function(p){var t=c.onMouseOut,u=p.currentTarget;p=p.relatedTarget;if(!p||u===p||!g.contains(u,p))t&&t.call(u)})});return this}}}()));
k.reg("indexFocus",w.create(l,{actionMgr:q,onactiontrig:function(c){var e=c.data;switch(e.e){case "cls":g.cookie(c.get("cn"),1);this.display(0);break;case "do":c=e.op;if(c==1)(c=k.use("postArea"))&&c.selectionHolder.insertText("#"+e.tp+"# ");else c==2&&e.ln&&window.open(decodeURIComponent(e.ln.replace(/\+/g,"%20")))}}}));k.reg("MoreList",function(c){c=k.use("Layer",g.extend({closeable:q,contextable:q,actionMgr:q,onactiontrig:function(e){var h=e.data,j=e.get("u");switch(h.e){case "abl":s.confirm("提示",
"确定将"+h.nick+"加入到黑名单吗？<span>你和"+(h.gender=="f"?"她":"他")+"将自动解除关注关系，并且她不能再关注你，给你发评论、私信、@通知。</span>",function(p){p==="ok"&&r.blacklistAdd(j,"",function(t){t.isOk()&&window.location.reload()})})}}},c));k.reg("MoreList",c,q);return c});k.report=function(){function c(){var u=k.getCfg("uid");if(!u){u=g.cookie("x3w4b");if(!u){u=(u=void 0)||16;for(var v=["u"],B,E=0;E<u;E++){B=Math.ceil(Math.random()*62)-1;v.push("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".charAt(B))}u=v.join("");g.cookie("x3w4b",
u,{expires:9E4})}return u}return u}function e(u){p.random=Math.random();p.uid=c();p.akey=k.getCfg("akey");u=g.extend(p,u);var v=[];g.each(u,function(B,E){v.push(B+"="+encodeURIComponent(E))});j.src=h+"?"+v.join("&")}var h="http://beacon.x.weibo.com/a.gif",j,p={pjt:"xwb",ver:"1.1.0",xt:"stay"},t=function(){function u(){if(!B){c();j=new Image;B=q}}function v(){var L=(new Date).getTime();e({time:L-(F?F:E),p:k.getCfg("page")});F=L}var B=false,E=(new Date).getTime(),F=0;return{start:function(){u();window.setInterval(v,
18E5)},report:function(){!B&&u();v()}}}();return{start:function(){t.start()},report:function(){t.report()}}}()})(Xwb,jQuery);(function(k,g){var q=k.request,A=k.ui.MsgBox,y=k.getCfg,w=k.getWb;k.use("action").addFilter(function(m,l){if(!l||!l.na){var n=k.getUid(),r=k.getSiteUid(),s=y("loginCfg");if(!n){if(r)if(m.get("e")=="lg")k.ui.oAuthLogin.show("bind");else window.location=q.mkUrl("account","bind");else{if(m.get("t")=="sinaLogin")s=1;switch(s){case 3:k.use("LoginBox",{siteName:y("siteName")}).display(true);break;case 2:window.location=q.mkUrl("account","siteLogin");break;default:k.ui.oAuthLogin.show()}}return false}}},
true).reg("sd",function(m){k.use("postBox").display(true).reset().selectionHolder.setText(m.get("m")||"")}).reg("fw",function(m){m=m.get("w");Xwb.use("forwardBox").display(true).setContent(m,w(m),k.getUid()).selectionHolder.focusStart()}).reg("fl",function(m){var l=m.get("u");g(m.src);m.lock(1);q.follow(l,0,function(n){if(n.isOk()||n.getCode()=="1020805"){n=m.get("t");var r=g(m.src);switch(parseInt(n)){case 1:r.replaceWith('<span class="followed-btn">已关注</span>');break;case 2:r.replaceWith("<em>已关注</em>");
break;default:location.reload()}}else A.tipWarn(n.getMsg());m.lock(0)})}).reg("ufl",function(m){A.anchorConfirm(m.src,"确定要取消关注？",function(l){if(l=="ok"){m.lock(1);l=m.get("u");var n=m.get("f");q.unfollow(l,"",function(r){if(r.isOk())n==1?g(m.src).replaceWith('<a rel="e:fl,t:2" href="#">关注他</a>'):window.location.reload();else A.tipWarn(r.getMsg());m.lock(0)})}})}).reg("rl",function(){window.location.reload()},{na:true}).reg("fr",function(m){var l=m.get("w");m.lock(1);q.fav(l,function(n){if(n.isOk()){A.anchorTipOk(m.src,
"收藏成功！");g(m.src).replaceWith("<span>已收藏</span>")}else A.tipWarn(n.getMsg());m.lock(0)})}).reg("ufr",function(m){A.anchorConfirm(m.src,"确定要删除该收藏？",function(l){if(l=="ok"){m.lock(1);l=m.get("w");q.delFav(l,function(n){if(n.isOk())if(y("page")=="fav"){var r=g(m.getEl("w"));r.slideUp(500,function(){r.remove();m.lock(0)})}else{g(m.src).replaceWith('<a rel="e:fr" href="#">收藏</a>');m.lock(0)}})}})}).reg("cm",function(m){var l=m.get("w"),n=g(m.getEl("w")),r=n.data("xwb_cmt");if(!r){var s=w(l);r=k.use("CmtArea",
{wbId:l,wbUid:s&&s.u.id,appendTo:n.find(".feed-content"),trigEl:m.src});n.data("xwb_cmt",r)}if(r.display())r.display(false);else{r.display(true);r.load(function(){r.cmtBox.jqInputor.focus()})}}).reg("tl",function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){m=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(m)});l.data("wbEle",n)}n.trun("left")},{na:true}).reg("tr",function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){m=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(m)});l.data("wbEle",n)}n.trun("right")},
{na:true}).reg("zo",function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){m=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(m)});l.data("wbEle",n)}n.zoomOut()},{na:true}).reg("zi",function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){m=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(m)});l.data("wbEle",n)}n.zoomIn()},{na:true}).reg("pv",function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){n=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(n)});l.data("wbEle",n)}n.playVideo(m)},{na:true}).reg("cv",
function(m){var l=g(m.getEl("w")),n=l.data("wbEle");if(!n){n=m.get("w");n=k.use("WbElement",{$wb:l,wbData:w(n)});l.data("wbEle",n)}n.closeVideo(m)},{na:true}).reg("dl",function(m){var l=m.get("w");A.anchorConfirm(m.src,"确定删除该微博吗？",function(n){if(n==="ok"){m.lock(1);q.del(l,function(r){var s=g(m.getEl("w"));r.isOk()?s.slideUp("normal",function(){s.remove();var D=g("#user-weibo-count");if(D.length){var x=D.text().match(/\d+/g);D.text(x-1)}}):A.tipWarn(r.getMsg());m.lock(0)})}})}).reg("mop",function(m){m=
g(m.src);var l=m.data("morelayer");if(!l){l=k.use("MoreList",{view:g("#more_list")[0]});m.data("morelayer",l)}l.display(1)}).reg("sdm",function(m){var l=k.use("myMsg");l.display(true).reset();var n=m.get("c");n&&l.selectionHolder.setText(n);(m=m.get("n"))&&l.jqSender.val(m);m?l.jqContent.focus():l.jqSender.focus()}).reg("rm",function(m){k.use("myMsg").reply(m.get("u"),m.get("n"))}).reg("dm",function(m){A.anchorConfirm(m.src,"确定要删除该私信？",function(l){if(l=="ok"){m.lock(1);l=m.get("m");q.delMsg(l,function(n){n.isOk()&&
location.reload();m.lock(0)})}})}).reg("dbl",function(m){function l(){m.lock(1);var r=m.get("u");q.blacklistDel(r,"",function(s){s.isOk()?location.reload():A.tipWarn(s.getMsg());m.lock(0)})}var n=m.data.m;n?A.confirm("提示",n,function(r){r==="ok"&&l()}):l()})})(Xwb,$);$(function(){(function(k,g){g("#logo").length&&g("#logo").fixPng();var q=k.ui,A=k.cfg,y=k.request,w=k.getCfg,m=w("basePath"),l=w("page");k.use("action").bind(document.body);m&&y.init(m);if(k.getUid()){y=w("remind");k.use("notice",{appendTo:y?document.body:g("#xwbInnerNav")[0],remindType:y,latestWid:w("maxid")})}g("#publish_box").each(function(){var n=k.reg("postArea",k.use("base",{view:this}));g.extend(n,q.PostBase);n.initEx();n.display(true)});g("#xwb_weibo_list").each(function(){k.reg("weiboList",
k.use("WeiboList",{view:this})).display(true)});g("#xwb_search_form").each(function(){k.use("SearchEntry",{view:this}).display(true)});switch(l){case "":case "index":k.getUid()&&location.href.indexOf("skinset=1")>=0&&k.use("skin",{view:g("#xwbSkinSet")[0],tab:{selectedCS:"current",items:g("#tabItems>span"),contents:g("#tabPanels>div")}}).display(true);break;case "index.messages":g("#messageList li").hover(function(){g(this).find("#del").cssDisplay(true)},function(){g(this).find("#del").cssDisplay(false)});
break;case "show":w=g("#xwb_cmt_list");y=w.attr("wbid");A=k.use("MBlogCmtArea",{view:w[0],wbId:y,wbUid:A.wbList&&A.wbList[y].u.id,topCmtBox:g("#topCmtBox")[0],faceSize:50});A.display(true).load();A.topCmtBox.jqInputor.focus();break;case "index.comments":case "index.commentsend":w=g("#xwb_cmt_list");k.use("MyCmt",{view:w[0]}).display(true)}switch(l){case "follow":g("#user_list").each(function(){k.use("FriendList",{view:this,onMouseOver:function(){g(this).find("a.forjs-cancel-att").show()},onMouseOut:function(){g(this).find("a.forjs-cancel-att").hide()}}).getView();
g(this).click(function(n){var r=g(n.target);if(!r.data("loading")&&r.hasClass("forjs-cancel-att")){var s=r.closest("LI");n=s.find("div.user-pic img").attr("title");var D=k.ui.MsgBox;D.confirm("提示","确定要取消关注"+n+"?",function(x){if(x==="ok"){r.data("loading",1);k.request.unfollow(r.attr("rel"),"",function(G){G.isOk()?s.slideUp(500,function(){s.remove()}):D.tipWarn(G.getMsg())})}})}})});break;case "fans":g("#user_list").each(function(){k.use("FriendList",{view:this,onMouseOver:function(){g(this).find("#removeFans,#sendMsg").removeClass("hidden")},
onMouseOut:function(){g(this).find("#removeFans,#sendMsg").addClass("hidden")}}).getView();g(this).click(function(n){var r=g(n.target);if(!r.data("loading")&&r.hasClass("forjs-cancel-att")){var s=r.closest("LI");n=s.find("div.user-pic img").attr("title");var D=k.ui.MsgBox;D.confirm("提示","移除之后将取消"+n+"对你的关注?",function(x){if(x==="ok"){r.data("loading",1);k.request.removeFans(r.attr("rel"),"",function(G){G.isOk()?s.slideUp(500,function(){s.remove()}):D.tipWarn(G.getMsg())})}})}})});break;case "search":case "search.weibo":case "search.user":l=
l=="search.user"?g("div.user-list"):g("div.feed-list");l=l.add(g("div.fame-list"));l.length&&l.highlight(g("#k").val());case "search.recommend":!location.hash&&g("#k").focus();g("#searchForm").bind("submit",function(){if(!g.trim(g("#k").val())){g("#searchTip").cssDisplay(true);g("#k").focus();return false}});g("#searchBtn").click(function(){if(k.util.byteCut(g.trim(g("#k").val()),30))g("#searchForm").submit();else{g("#searchTip").cssDisplay(true);g("#k").focus()}return false});break;case "pub":g("#win_city").each(function(){var n=
this,r=k.use("Layer",{closeable:true,contextable:true,provinces:null,view:n,onViewReady:function(){k.request.getProvinces(k.util.bind(this.onDataLoaded,this))},onDataLoaded:function(s){if(s.isOk()){this.provinces=s.getData().provinces;var D=this;this.jq("#sel-area").change(function(){D.changeProvince(this.value)})}},changeProvince:function(s){if(this.provinces){var D=this;g.each(this.provinces,function(x,G){if(G.id==s){var N=[];g.each(G.citys,function(c,e){var h,j;for(c in e){h=c;j=e[c]}N.push('<a href="'+
(m+"index.php?m=pub&province="+s+"&city="+h+"#city")+'">'+j+"</a>")});D.jq("#citys").html(N.join(""));return false}})}}});g("#cityBtn").click(function(){r.display(g(n).hasClass("hidden"));return false})})}q.linkRender();g("#hot_mblog div.feed-list").each(function(n){q.updateCount.addHook(function(r,s){return function(D){r.find("#xwb_weibo_list_ct>li").each(function(){var x=g(this),G=x.attr("rel").split(":")[1];(G=D[G])&&x.find("strong").text(G[s?0:1])})}}(g(this),n))});q.updateCount();g("#xwb_today_topic").each(function(){g(this).find("p.feedback").substrText(80,
1);g(this).find("div.column-item:first").removeClass("next");k.use("FadeBox",{view:this}).display(1)});g("#hot_mblog").each(function(){var n=g(this);k.use("Switcher",{items:n.find("div.tab-s2>span"),contents:n.find("div.hot-mblog-body"),trigMode:"click",selectedCS:"current"})});k.report.start();g(window).bind("unload",function(){k.report.report()})})(Xwb,$)});(function(k,g){Xwb.ax.Validator.prototype.reg("ne",function(q,A,y,w){q=A==="";if(!q&&y.w)(q=A==y.w)&&this.setValue("");if(q&&!y.m)y.m="该项不能为空";this.report(!q,y);w()}).reg("f",function(q){var A=this;g(q).blur(function(){A.validElement(this)})}).reg("sz",function(q,A,y,w){q=y.ww?Xwb.util.byteLen(A):A.length;var m;A=y.max;var l=y.min;if(A!==undefined&&parseInt(A)<q)m=true;if(l!==undefined&&parseInt(l)>q)m=true;this.report(!m,y);w()}).reg("dt",function(q,A,y,w){if(!y.m)y.m="不是有效的日期格式";q=Date.parse(A);
this.report(!isNaN(q),y);w()}).reg("sinan",function(q,A,y,w){if(!y.m)y.m='支持中英文、数字、"_"或减号';this.report(/^[a-zA-Z0-9\u4e00-\u9fa5_-]+$/.test(A),y);w()})})(Xwb,$);
